# CipherLink - Self contained data url based secret sharing tool

## Overview

This tool lets you share secret with a password or key with zero infrastructure and only requires a browser. It doesnt even require a network connection. It is not audited, and just for fun, I make no guarentees on security and take no responsibility anything you do with it.

## How to use

Build it by running build.py. Or use the build output url at the end of this readme. Input your secret message, and a password and generate a shareable url (it will be big). Send that url to the recipient. Then, on a different channel, send the password. Eg, send the data url by email, and password on whatsapp, set to disappear. Always build the url yourself or get it from this readme.

## Security Notes

- Crypto was all re-implemented in js, because there's no crypto.subtle in the data url context in browsers. Yes, I could have used an audited implementation, but this is for fun. Theres is a small test script that does a few simple sanity checks.
- There's no point sending the url and password over the same channel. You're sending plain text at that point.
- It would be cool to write this as a quine, so someone who receives a message could then send their own message. But it's better to link them to somewhere to get the trusted intitial data url.

# URL
Copy this url into your browser bar to use the tool:
```url
data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+Q2lwaGVyTGluazwvdGl0bGU+CjxzdHlsZT4KICBib2R5IHsKICAgIGZvbnQtZmFtaWx5OiBzeXN0ZW0tdWksIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgbWFyZ2luOiAycmVtOwogICAgbGluZS1oZWlnaHQ6IDEuNAogIH0KCiAgdGV4dGFyZWEgewogICAgd2lkdGg6IDEwMCU7CiAgICBtaW4taGVpZ2h0OiA4cmVtCiAgfQoKICBpbnB1dCwKICBidXR0b24sCiAgdGV4dGFyZWEgewogICAgZm9udDogaW5oZXJpdDsKICAgIHBhZGRpbmc6IC41cmVtOwogICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsKICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgfQoKICBidXR0b24gewogICAgY3Vyc29yOiBwb2ludGVyCiAgfQoKICAucm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBnYXA6IC41cmVtOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbjogLjVyZW0gMAogIH0KCiAgLm91dCB7CiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICBib3JkZXI6IDFweCBkYXNoZWQgI2RkZDsKICAgIHBhZGRpbmc6IDFyZW07CiAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgIGJhY2tncm91bmQ6ICNmYWZhZmE7CiAgICB3b3JkLWJyZWFrOiBicmVhay1hbGwKICB9Cjwvc3R5bGU+Cgo8Ym9keT4KICA8aDE+Q2lwaGVyTGluazwvaDE+CiAgPHA+U2VuZCBzZWNyZXRzIHdpdGggYSBTZWxmLWNvbnRhaW5lZCBkYXRhIFVSTCB1c2luZyBQQktERjIgKyBBRVMtR0NNLjwvcD4KICA8cD4KICAgIDxzdHJvbmc+V2FybmluZzo8L3N0cm9uZz4gVXNlIHRoaXMgdG9vbCBhdCB5b3VyIG93biByaXNrLiBBbHdheXMgZW5zdXJlIHlvdSBnb3QgdGhlIGxpbmsgZnJvbQogICAgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2hpbGxhYy9DaXBoZXJMaW5rIj5odHRwczovL2dpdGh1Yi5jb20vaGlsbGFjL0NpcGhlckxpbms8L2E+IGFuZCB2ZXQgdGhlIGNvZGUgeW91cnNlbGYuCiAgPC9wPgogIDxwPk1ha2Ugc3VyZSB0byB1c2UgYSBzdHJvbmcgcGFzc3dvcmQuIFRoaXMgdG9vbCBkb2VzIG5vdCBlbmZvcmNlIGFueSBwYXNzd29yZCBzdHJlbmd0aCByZXF1aXJlbWVudHMuPC9wPgogIDxwPk1ha2Ugc3VyZSB5b3Ugc2VuZCB0aGUgcGFzc3dvcmQgb3ZlciBhIGRpZmZlcmVudCBjaGFubmVsIHRvIHRoZSBkYXRhIHVybC4gT3IgZWxzZSB5b3UncmUganVzdCBzZW5kaW5nIHBsYWluIHRleHQuCiAgICBFZyBzZW5kIGRhdGEgdXJsIG9uIGVtYWlsIGFuZCBwYXNzd29yZCBvbiB3aGF0c2FwcCBhcyBhIGRpc2FwcGVlcmluZyBtZXNzYWdlLjwvcD4KCiAgPGxhYmVsPlNlY3JldDwvbGFiZWw+CiAgPHRleHRhcmVhIGlkPSJzZWNyZXQiIHBsYWNlaG9sZGVyPSJUeXBlIHlvdXIgc2VjcmV0IGhlcmUuLi4iPjwvdGV4dGFyZWE+CgogIDxkaXYgY2xhc3M9InJvdyI+CiAgICA8bGFiZWwgZm9yPSJwdyI+UGFzc3dvcmQ6PC9sYWJlbD4KICAgIDxpbnB1dCBpZD0icHciIHR5cGU9InBhc3N3b3JkIiBwbGFjZWhvbGRlcj0iUGFzc3dvcmQiIC8+CiAgICA8YnV0dG9uIGlkPSJnZW5lcmF0ZS1wdyI+R2VuIHN0cm9uZyBwYXNzd29yZDwvYnV0dG9uPgogIDwvZGl2PgogIDxidXR0b24gaWQ9ImdvIj5FbmNyeXB0IG1lc3NhZ2U8L2J1dHRvbj4KCiAgPGgzPk91dHB1dDwvaDM+CiAgPGRpdiBjbGFzcz0icm93Ij4KICAgIDxidXR0b24gaWQ9ImNvcHktcHciIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImNvcHktYnRuIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDAuNXJlbTsiPkNvcHkgUGFzc3dvcmQ8L2J1dHRvbj4KICAgIDxidXR0b24gaWQ9ImNvcHktdXJsIiBjbGFzcz0iY29weS1idG4iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+Q29weSBVUkw8L2J1dHRvbj4KICA8L2Rpdj4KCiAgPGRpdiBpZD0idXJsIiBjbGFzcz0ib3V0Ij48L2Rpdj4KCiAgPHRlbXBsYXRlIGlkPSJkZWNvZGUtdGVtcGxhdGUiPgogICAgPCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+Q2lwaGVyTGluazwvdGl0bGU+CjxzdHlsZT4KICAgIGJvZHkgewogICAgICAgIGZvbnQtZmFtaWx5OiBzeXN0ZW0tdWksIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgIG1hcmdpbjogMnJlbTsKICAgICAgICBsaW5lLWhlaWdodDogMS40CiAgICB9CgogICAgaW5wdXQsCiAgICBidXR0b24sCiAgICB0ZXh0YXJlYSB7CiAgICAgICAgZm9udDogaW5oZXJpdDsKICAgICAgICBwYWRkaW5nOiAuNXJlbTsKICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogICAgICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgICB9CgogICAgYnV0dG9uIHsKICAgICAgICBjdXJzb3I6IHBvaW50ZXIKICAgIH0KCiAgICAucm93IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGdhcDogLjVyZW07CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBtYXJnaW46IC41cmVtIDAKICAgIH0KCiAgICAub3V0IHsKICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgYm9yZGVyOiAxcHggZGFzaGVkICNkZGQ7CiAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhCiAgICB9Cjwvc3R5bGU+Cgo8Ym9keT4KICAgIDxoMT5DaXBoZXJMaW5rPC9oMT4KICAgIDxwPkVudGVyIHBhc3N3b3JkIHRvIGRlY3J5cHQ8L3A+CiAgICA8Zm9ybSBpZD0iZm9ybSI+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgPGlucHV0IGlkPSJwdyIgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJQYXNzd29yZCIgcmVxdWlyZWQgLz4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkRlY3J5cHQ8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZm9ybT4KICAgIDxkaXYgaWQ9InN0YXR1cyI+PC9kaXY+CiAgICA8cCBpZD0iYWR2ZXJ0IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPklmIHlvdSB3YW50IHRvIHVzZSB0aGlzIHRvb2wgdG8gc2VuZCBzZWNyZXRzIHlvdXJzZWxmLCBnbyB0byA8YQogICAgICAgICAgICBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vaGlsbGFjL0NpcGhlckxpbmsiPmh0dHBzOi8vZ2l0aHViLmNvbS9oaWxsYWMvQ2lwaGVyTGluazwvYT48L3A+CgogICAgPGgzPlJlc3VsdDwvaDM+CiAgICA8ZGl2IGlkPSJvdXQiIGNsYXNzPSJvdXQiPjwvZGl2PgoKICAgIDxzY3JpcHQgdHlwZT0ibW9kdWxlLXNvdXJjZSIgaWQ9ImFlczI1NmdjbS1zY3JpcHQiPgogICAgICAgIF9fSU5DTFVERV9BRVMyNTZHQ01fSlNfMl9fCiAgICA8L3NjcmlwdD4KCiAgICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJwYmtkZjItc2NyaXB0Ij4KICAgICAgICBfX0lOQ0xVREVfUEJLREYyX0pTXzJfXwogICAgPC9zY3JpcHQ+CgogICAgPHNjcmlwdCB0eXBlPSJtb2R1bGUiPgogICAgICAgIGNvbnN0ICQgPSAocykgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKTsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gbG9hZElubGluZU1vZHVsZShpZCkgewogICAgICAgICAgICBjb25zdCBjb2RlID0gJCgnIycgKyBpZCkudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6ICd0ZXh0L2phdmFzY3JpcHQnIH0pKTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGltcG9ydCh1cmwpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYWVzMjU2Z2NtID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgnYWVzMjU2Z2NtLXNjcmlwdCcpOwogICAgICAgIGNvbnN0IHBia2RmMiA9IGF3YWl0IGxvYWRJbmxpbmVNb2R1bGUoJ3Bia2RmMi1zY3JpcHQnKTsKCiAgICAgICAgLy8gPT09IEZpbGxlZCBieSB0aGUgZ2VuZXJhdG9yID09PQogICAgICAgIGNvbnN0IENJUEhFUlRFWFRfQjY0ID0gIl9fQ0lQSEVSVEVYVF9CNjRfXyI7CiAgICAgICAgY29uc3QgSVZfQjY0ID0gIl9fSVZfQjY0X18iOwogICAgICAgIGNvbnN0IFNBTFRfQjY0ID0gIl9fU0FMVF9CNjRfXyI7CiAgICAgICAgY29uc3QgVEFHX0I2NCA9ICJfX1RBR19CNjRfXyI7CiAgICAgICAgY29uc3QgSVRFUkFUSU9OUyA9IF9fSVRFUkFUSU9OU19fOwoKICAgICAgICBjb25zdCBlbmMgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgICAgICBjb25zdCBkZWMgPSBuZXcgVGV4dERlY29kZXIoKTsKCiAgICAgICAgY29uc3QgYjY0VG9CeXRlcyA9IChiNjQpID0+IFVpbnQ4QXJyYXkuZnJvbShhdG9iKGI2NCksIGMgPT4gYy5jaGFyQ29kZUF0KDApKTsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGVjcnlwdFNlY3JldChwYXNzd29yZCkgewogICAgICAgICAgICBjb25zdCBzYWx0ID0gYjY0VG9CeXRlcyhTQUxUX0I2NCk7CiAgICAgICAgICAgIGNvbnN0IGl2ID0gYjY0VG9CeXRlcyhJVl9CNjQpOwogICAgICAgICAgICBjb25zdCBjaXBoZXJ0ZXh0ID0gYjY0VG9CeXRlcyhDSVBIRVJURVhUX0I2NCk7CiAgICAgICAgICAgIGNvbnN0IHRhZyA9IGI2NFRvQnl0ZXMoVEFHX0I2NCk7CgogICAgICAgICAgICAvLyBEZXJpdmUga2V5IHVzaW5nIHB1cmUgSlMgUEJLREYyCiAgICAgICAgICAgIGNvbnN0IGtleSA9IHBia2RmMi5wYmtkZjJTaGEyNTYoewogICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGVuYy5lbmNvZGUocGFzc3dvcmQpLAogICAgICAgICAgICAgICAgc2FsdDogc2FsdCwKICAgICAgICAgICAgICAgIGl0ZXJhdGlvbnM6IElURVJBVElPTlMsCiAgICAgICAgICAgICAgICBka0xlbjogMzIgLy8gMjU2IGJpdHMgZm9yIEFFUy0yNTYKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gRGVjcnlwdCB1c2luZyBBRVMtR0NNCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhZXMyNTZnY20uYWVzMjU2R2NtRGVjcnlwdCh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgICAgaXY6IGl2LAogICAgICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IGNpcGhlcnRleHQsCiAgICAgICAgICAgICAgICAgICAgdGFnOiB0YWcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0Lm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEZWNyeXB0aW9uIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBkZWMuZGVjb2RlKHJlc3VsdC5wbGFpbnRleHQpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRlY3J5cHRpb24gZmFpbGVkICh3cm9uZyBwYXNzd29yZCBvciBjb3JydXB0ZWQgZGF0YSkuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICQoIiNmb3JtIikuYWRkRXZlbnRMaXN0ZW5lcigic3VibWl0IiwgYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBzdGF0dXMgPSAkKCIjc3RhdHVzIik7CiAgICAgICAgICAgIGNvbnN0IG91dCA9ICQoIiNvdXQiKTsKICAgICAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gIkRlY3J5cHRpbmcuLi4iOwogICAgICAgICAgICBvdXQudGV4dENvbnRlbnQgPSAiIjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHB3ID0gJCgiI3B3IikudmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBwbGFpbnRleHQgPSBhd2FpdCBkZWNyeXB0U2VjcmV0KHB3KTsKICAgICAgICAgICAgICAgIG91dC50ZXh0Q29udGVudCA9IHBsYWludGV4dDsKICAgICAgICAgICAgICAgIHN0YXR1cy50ZXh0Q29udGVudCA9ICJTdWNjZXNzLiI7CiAgICAgICAgICAgICAgICAkKCIjYWR2ZXJ0Iikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gZXJyLm1lc3NhZ2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+CiAgPC90ZW1wbGF0ZT4KCiAgPCEtLSBub25zZW5zZSB0eXBlIHRvIGF2b2lkIGV4ZWN1dGlvbiAtLT4KICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJhZXMyNTZnY20tc2NyaXB0Ij4KICAgIAoKY29uc3QgUiA9IDB4ZTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBuOyAKCmZ1bmN0aW9uIHRvVTgodikgewogIHJldHVybiB2IGluc3RhbmNlb2YgVWludDhBcnJheSA/IHYgOiBuZXcgVWludDhBcnJheSh2KTsKfQpmdW5jdGlvbiB4b3JCeXRlcyhhLCBiKSB7CiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoYS5sZW5ndGgpOwogIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgb3V0W2ldID0gYVtpXSBeIGJbaV07CiAgcmV0dXJuIG91dDsKfQpmdW5jdGlvbiB6ZXJvKG4pIHsKICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkobik7Cn0KCmZ1bmN0aW9uIGJ5dGVzVG9CaWdJbnRCRShiKSB7CiAgbGV0IHggPSAwbjsKICBmb3IgKGxldCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspIHggPSAoeCA8PCA4bikgfCBCaWdJbnQoYltpXSk7CiAgcmV0dXJuIHg7Cn0KZnVuY3Rpb24gYmlnSW50VG9CeXRlc0JFKHgsIGxlbikgewogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgZm9yIChsZXQgaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBvdXRbaV0gPSBOdW1iZXIoeCAmIDB4ZmZuKTsKICAgIHggPj49IDhuOwogIH0KICByZXR1cm4gb3V0Owp9Cgpjb25zdCBiNjRUb1U4ID0gKGI2NCkgPT4gVWludDhBcnJheS5mcm9tKGF0b2IoYjY0KSwgKGMpID0+IGMuY2hhckNvZGVBdCgwKSk7Cgpjb25zdCBTID0gYjY0VG9VOCgKICAiWTN4M2UvSnJiOFV3QVdjci90ZXJkc3FDeVgzNldVZndyZFNpcjV5a2NzQzMvWk1tTmovM3pEU2w1ZkZ4MkRFVkJNY2p3eGlXQlpvSEVvRGk2eWV5ZFFtRExCb2JibHFnVWp2V3N5bmpMNFJUMFFEdElQeXhXMnJMdmpsS1RGalAwTytxKzBOTk00VkYrUUovVUR5ZnFGR2pRSStTblRqMXZMYmFJUkQvODlMTkRCUHNYNWRFRjhTbmZqMWtYUmx6WUlGUDNDSXFrSWhHN3JnVTNsNEwyK0F5T2dwSkJpUmN3dE9zWXBHVjVIbm55RGR0amRWT3FXeFc5T3BsZXE0SXVuZ2xMaHltdE1ibzNYUWZTNzJMaW5BK3RXWklBL1lPWVRWWHVZYkJIWjdoK0pnUmFkbU9sSnNlaCtuT1ZTamZqS0dKRGIvbVFtaEJtUzBQc0ZTN0ZnPT0iCik7CmNvbnN0IFJjb24gPSBiNjRUb1U4KCJBQUVDQkFnUUlFQ0FHelpzMkt0Tm1nPT0iKTsKCmZ1bmN0aW9uIHJvdFdvcmQodykgewogIHJldHVybiBbd1sxXSwgd1syXSwgd1szXSwgd1swXV07Cn0KZnVuY3Rpb24gc3ViV29yZCh3KSB7CiAgcmV0dXJuIHcubWFwKCh4KSA9PiBTW3hdKTsKfQoKZnVuY3Rpb24ga2V5RXhwYW5kMjU2KGtleSkgewogIGtleSA9IHRvVTgoa2V5KTsKICBpZiAoa2V5Lmxlbmd0aCAhPT0gMzIpIHRocm93IG5ldyBFcnJvcigiQUVTLTI1NiBrZXkgbXVzdCBiZSAzMiBieXRlcyIpOwoKICBjb25zdCBOayA9IDgsCiAgICBOYiA9IDQsCiAgICBOciA9IDE0OwogIGNvbnN0IHcgPSBuZXcgVWludDhBcnJheShOYiAqIChOciArIDEpICogNCk7CiAgdy5zZXQoa2V5KTsKICBjb25zdCB0ZW1wID0gWzAsIDAsIDAsIDBdOwogIGxldCBieXRlc0dlbmVyYXRlZCA9IDMyOwogIGxldCByY29uSXRlciA9IDE7CgogIHdoaWxlIChieXRlc0dlbmVyYXRlZCA8IHcubGVuZ3RoKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgdGVtcFtpXSA9IHdbYnl0ZXNHZW5lcmF0ZWQgLSA0ICsgaV07CiAgICBpZiAoKGJ5dGVzR2VuZXJhdGVkIC8gNCkgJSBOayA9PT0gMCkgewogICAgICBsZXQgdCA9IHJvdFdvcmQodGVtcCk7CiAgICAgIHQgPSBzdWJXb3JkKHQpOwogICAgICB0WzBdIF49IFJjb25bcmNvbkl0ZXIrK107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB0ZW1wW2ldID0gdFtpXTsKICAgIH0gZWxzZSBpZiAoKGJ5dGVzR2VuZXJhdGVkIC8gNCkgJSBOayA9PT0gNCkgewogICAgICBsZXQgdCA9IHN1YldvcmQodGVtcCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB0ZW1wW2ldID0gdFtpXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgIHdbYnl0ZXNHZW5lcmF0ZWRdID0gd1tieXRlc0dlbmVyYXRlZCAtIDMyXSBeIHRlbXBbaV07CiAgICAgIGJ5dGVzR2VuZXJhdGVkKys7CiAgICB9CiAgfQogIHJldHVybiB3OyAKfQoKZnVuY3Rpb24gYWRkUm91bmRLZXkocywgcmssIHJvdW5kKSB7CiAgZm9yIChsZXQgYyA9IDA7IGMgPCA0OyBjKyspIHsKICAgIHNbMCArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAwXTsKICAgIHNbMSArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAxXTsKICAgIHNbMiArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAyXTsKICAgIHNbMyArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAzXTsKICB9Cn0KZnVuY3Rpb24gc3ViQnl0ZXMocykgewogIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgc1tpXSA9IFNbc1tpXV07Cn0KZnVuY3Rpb24gc2hpZnRSb3dzKHMpIHsKICBjb25zdCB0ID0gcy5zbGljZSgpOwogIHNbMV0gPSB0WzVdOwogIHNbNV0gPSB0WzldOwogIHNbOV0gPSB0WzEzXTsKICBzWzEzXSA9IHRbMV07CiAgc1syXSA9IHRbMTBdOwogIHNbNl0gPSB0WzE0XTsKICBzWzEwXSA9IHRbMl07CiAgc1sxNF0gPSB0WzZdOwogIHNbM10gPSB0WzE1XTsKICBzWzddID0gdFszXTsKICBzWzExXSA9IHRbN107CiAgc1sxNV0gPSB0WzExXTsKfQpmdW5jdGlvbiB4dGltZSh4KSB7CiAgcmV0dXJuICgoeCA8PCAxKSBeICh4ICYgMHg4MCA/IDB4MWIgOiAwKSkgJiAweGZmOwp9CmZ1bmN0aW9uIG1peENvbHVtbnMocykgewogIGZvciAobGV0IGMgPSAwOyBjIDwgNDsgYysrKSB7CiAgICBjb25zdCBpID0gNCAqIGM7CiAgICBjb25zdCBhMCA9IHNbaV0sCiAgICAgIGExID0gc1tpICsgMV0sCiAgICAgIGEyID0gc1tpICsgMl0sCiAgICAgIGEzID0gc1tpICsgM107CiAgICBjb25zdCByMCA9IHh0aW1lKGEwKSBeIChhMSBeIHh0aW1lKGExKSkgXiBhMiBeIGEzOwogICAgY29uc3QgcjEgPSBhMCBeIHh0aW1lKGExKSBeIChhMiBeIHh0aW1lKGEyKSkgXiBhMzsKICAgIGNvbnN0IHIyID0gYTAgXiBhMSBeIHh0aW1lKGEyKSBeIChhMyBeIHh0aW1lKGEzKSk7CiAgICBjb25zdCByMyA9IGEwIF4geHRpbWUoYTApIF4gYTEgXiBhMiBeIHh0aW1lKGEzKTsKICAgIHNbaV0gPSByMCAmIDB4ZmY7CiAgICBzW2kgKyAxXSA9IHIxICYgMHhmZjsKICAgIHNbaSArIDJdID0gcjIgJiAweGZmOwogICAgc1tpICsgM10gPSByMyAmIDB4ZmY7CiAgfQp9CmZ1bmN0aW9uIGFlc0VuY3J5cHRCbG9jayhyaywgYmxvY2sxNikgewogIGNvbnN0IE5yID0gMTQ7CiAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KGJsb2NrMTYpOwogIGFkZFJvdW5kS2V5KHMsIHJrLCAwKTsKICBmb3IgKGxldCByb3VuZCA9IDE7IHJvdW5kIDwgTnI7IHJvdW5kKyspIHsKICAgIHN1YkJ5dGVzKHMpOwogICAgc2hpZnRSb3dzKHMpOwogICAgbWl4Q29sdW1ucyhzKTsKICAgIGFkZFJvdW5kS2V5KHMsIHJrLCByb3VuZCk7CiAgfQogIHN1YkJ5dGVzKHMpOwogIHNoaWZ0Um93cyhzKTsKICBhZGRSb3VuZEtleShzLCByaywgTnIpOwogIHJldHVybiBzOwp9CgpmdW5jdGlvbiBpbmMzMihjb3VudGVyMTYpIHsKICBjb25zdCBvdXQgPSBjb3VudGVyMTYuc2xpY2UoKTsKICAKICBsZXQgY2FycnkgPSAxOwogIGZvciAobGV0IGkgPSAxNTsgaSA+PSAxMjsgaS0tKSB7CiAgICBjb25zdCB2ID0gKG91dFtpXSB8IDApICsgY2Fycnk7CiAgICBvdXRbaV0gPSB2ICYgMHhmZjsKICAgIGNhcnJ5ID0gdiA+Pj4gODsKICAgIGlmICghY2FycnkpIGJyZWFrOwogIH0KICByZXR1cm4gb3V0Owp9CgpmdW5jdGlvbiBnaGFzaE11bHRpcGx5KHgxMjgsIHkxMjgpIHsKICBsZXQgWiA9IDBuOwogIGxldCBWID0geTEyODsKICBmb3IgKGxldCBpID0gMDsgaSA8IDEyODsgaSsrKSB7CiAgICBjb25zdCBiaXQgPSAoeDEyOCA+PiBCaWdJbnQoMTI3IC0gaSkpICYgMW47CiAgICBpZiAoYml0KSBaIF49IFY7CiAgICBpZiAoKFYgJiAxbikgPT09IDBuKSB7CiAgICAgIFYgPj49IDFuOwogICAgfSBlbHNlIHsKICAgICAgViA9IChWID4+IDFuKSBeIFI7CiAgICB9CiAgfQogIHJldHVybiBaOwp9CgpmdW5jdGlvbiBnaGFzaChILCBBLCBDKSB7CiAgCiAgZnVuY3Rpb24gcGFkMTYodTgpIHsKICAgIGNvbnN0IHJlbSA9IHU4Lmxlbmd0aCAlIDE2OwogICAgcmV0dXJuIHJlbSA/IG5ldyBVaW50OEFycmF5KFsuLi51OCwgLi4ubmV3IFVpbnQ4QXJyYXkoMTYgLSByZW0pXSkgOiB1ODsKICB9CiAgY29uc3QgQV8gPSBwYWQxNihBKTsKICBjb25zdCBDXyA9IHBhZDE2KEMpOwoKICBsZXQgWSA9IDBuOwogIGNvbnN0IEhuID0gYnl0ZXNUb0JpZ0ludEJFKEgpOwoKICBmb3IgKGxldCBvZmYgPSAwOyBvZmYgPCBBXy5sZW5ndGg7IG9mZiArPSAxNikgewogICAgY29uc3QgWGkgPSBieXRlc1RvQmlnSW50QkUoQV8uc3ViYXJyYXkob2ZmLCBvZmYgKyAxNikpOwogICAgWSA9IGdoYXNoTXVsdGlwbHkoWSBeIFhpLCBIbik7CiAgfQogIGZvciAobGV0IG9mZiA9IDA7IG9mZiA8IENfLmxlbmd0aDsgb2ZmICs9IDE2KSB7CiAgICBjb25zdCBYaSA9IGJ5dGVzVG9CaWdJbnRCRShDXy5zdWJhcnJheShvZmYsIG9mZiArIDE2KSk7CiAgICBZID0gZ2hhc2hNdWx0aXBseShZIF4gWGksIEhuKTsKICB9CgogIGNvbnN0IGxlbkJsb2NrID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogIGNvbnN0IGFCaXRzID0gQmlnSW50KEEubGVuZ3RoKSAqIDhuOwogIGNvbnN0IGNCaXRzID0gQmlnSW50KEMubGVuZ3RoKSAqIDhuOwogIGxlbkJsb2NrLnNldChiaWdJbnRUb0J5dGVzQkUoYUJpdHMsIDgpLCAwKTsKICBsZW5CbG9jay5zZXQoYmlnSW50VG9CeXRlc0JFKGNCaXRzLCA4KSwgOCk7CgogIFkgPSBnaGFzaE11bHRpcGx5KFkgXiBieXRlc1RvQmlnSW50QkUobGVuQmxvY2spLCBIbik7CiAgcmV0dXJuIGJpZ0ludFRvQnl0ZXNCRShZLCAxNik7Cn0KCmZ1bmN0aW9uIGdjdHIocmssIGljYiwgaW5wdXQpIHsKICAKICBpZiAoaW5wdXQubGVuZ3RoID09PSAwKSByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQubGVuZ3RoKTsKICBsZXQgY3RyID0gaWNiLnNsaWNlKCk7CiAgZm9yIChsZXQgb2ZmID0gMDsgb2ZmIDwgaW5wdXQubGVuZ3RoOyBvZmYgKz0gMTYpIHsKICAgIGN0ciA9IGluYzMyKGN0cik7CiAgICBjb25zdCBrZXlzdHJlYW0gPSBhZXNFbmNyeXB0QmxvY2socmssIGN0cik7CiAgICBjb25zdCBjaHVuayA9IGlucHV0LnN1YmFycmF5KG9mZiwgTWF0aC5taW4ob2ZmICsgMTYsIGlucHV0Lmxlbmd0aCkpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVuay5sZW5ndGg7IGkrKykgewogICAgICBvdXRbb2ZmICsgaV0gPSBjaHVua1tpXSBeIGtleXN0cmVhbVtpXTsKICAgIH0KICB9CiAgcmV0dXJuIG91dDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGFlczI1NkdjbUVuY3J5cHQoewogIGtleSwKICBpdiwKICBwbGFpbnRleHQsCiAgYWFkID0gbmV3IFVpbnQ4QXJyYXkoMCksCiAgdGFnTGVuZ3RoID0gMTYsCn0pIHsKICBrZXkgPSB0b1U4KGtleSk7CiAgaXYgPSB0b1U4KGl2KTsKICBwbGFpbnRleHQgPSB0b1U4KHBsYWludGV4dCk7CiAgYWFkID0gdG9VOChhYWQpOwogIGlmIChrZXkubGVuZ3RoICE9PSAzMikgdGhyb3cgbmV3IEVycm9yKCJBRVMtMjU2IGtleSBtdXN0IGJlIDMyIGJ5dGVzIik7CiAgaWYgKHRhZ0xlbmd0aCAhPT0gMTYpCiAgICB0aHJvdyBuZXcgRXJyb3IoIk9ubHkgMTI4LWJpdCB0YWdzIHN1cHBvcnRlZCBpbiB0aGlzIHJlZmVyZW5jZSIpOwoKICBjb25zdCByayA9IGtleUV4cGFuZDI1NihrZXkpOwogIGNvbnN0IEggPSBhZXNFbmNyeXB0QmxvY2socmssIHplcm8oMTYpKTsgCgogIGxldCBKMDsKICBpZiAoaXYubGVuZ3RoID09PSAxMikgewogICAgSjAgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICBKMC5zZXQoaXYsIDApOwogICAgSjBbMTVdID0gMTsgCiAgfSBlbHNlIHsKICAgIGNvbnN0IFMgPSBnaGFzaChILCBuZXcgVWludDhBcnJheSgwKSwgaXYpOwogICAgSjAgPSBTOyAKICB9CgogIGNvbnN0IGNpcGhlcnRleHQgPSBnY3RyKHJrLCBKMCwgcGxhaW50ZXh0KTsgCiAgY29uc3QgUyA9IGdoYXNoKEgsIGFhZCwgY2lwaGVydGV4dCk7CiAgY29uc3QgdGFnID0geG9yQnl0ZXMoYWVzRW5jcnlwdEJsb2NrKHJrLCBKMCksIFMpLnN1YmFycmF5KDAsIHRhZ0xlbmd0aCk7CgogIHJldHVybiB7IGNpcGhlcnRleHQsIHRhZyB9Owp9CgpleHBvcnQgZnVuY3Rpb24gYWVzMjU2R2NtRGVjcnlwdCh7CiAga2V5LAogIGl2LAogIGNpcGhlcnRleHQsCiAgYWFkID0gbmV3IFVpbnQ4QXJyYXkoMCksCiAgdGFnLAp9KSB7CiAga2V5ID0gdG9VOChrZXkpOwogIGl2ID0gdG9VOChpdik7CiAgY2lwaGVydGV4dCA9IHRvVTgoY2lwaGVydGV4dCk7CiAgYWFkID0gdG9VOChhYWQpOwogIHRhZyA9IHRvVTgodGFnKTsKICBpZiAoa2V5Lmxlbmd0aCAhPT0gMzIpIHRocm93IG5ldyBFcnJvcigiQUVTLTI1NiBrZXkgbXVzdCBiZSAzMiBieXRlcyIpOwogIGlmICh0YWcubGVuZ3RoICE9PSAxNikKICAgIHRocm93IG5ldyBFcnJvcigiT25seSAxMjgtYml0IHRhZ3Mgc3VwcG9ydGVkIGluIHRoaXMgcmVmZXJlbmNlIik7CgogIGNvbnN0IHJrID0ga2V5RXhwYW5kMjU2KGtleSk7CiAgY29uc3QgSCA9IGFlc0VuY3J5cHRCbG9jayhyaywgemVybygxNikpOwoKICBsZXQgSjA7CiAgaWYgKGl2Lmxlbmd0aCA9PT0gMTIpIHsKICAgIEowID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgSjAuc2V0KGl2LCAwKTsKICAgIEowWzE1XSA9IDE7CiAgfSBlbHNlIHsKICAgIEowID0gZ2hhc2goSCwgbmV3IFVpbnQ4QXJyYXkoMCksIGl2KTsKICB9CgogIGNvbnN0IFMgPSBnaGFzaChILCBhYWQsIGNpcGhlcnRleHQpOwogIGNvbnN0IGV4cGVjdGVkVGFnID0geG9yQnl0ZXMoYWVzRW5jcnlwdEJsb2NrKHJrLCBKMCksIFMpLnN1YmFycmF5KAogICAgMCwKICAgIHRhZy5sZW5ndGgKICApOwoKICBpZiAoZXhwZWN0ZWRUYWcubGVuZ3RoICE9PSB0YWcubGVuZ3RoKSByZXR1cm4geyBvazogZmFsc2UsIHBsYWludGV4dDogbnVsbCB9OwogIGxldCBkaWZmID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IHRhZy5sZW5ndGg7IGkrKykgZGlmZiB8PSBleHBlY3RlZFRhZ1tpXSBeIHRhZ1tpXTsKICBpZiAoZGlmZiAhPT0gMCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBwbGFpbnRleHQ6IG51bGwgfTsKCiAgY29uc3QgcGxhaW50ZXh0ID0gZ2N0cihyaywgSjAsIGNpcGhlcnRleHQpOwogIHJldHVybiB7IG9rOiB0cnVlLCBwbGFpbnRleHQgfTsKfQoKICA8L3NjcmlwdD4KCiAgPHNjcmlwdCB0eXBlPSJtb2R1bGUtc291cmNlIiBpZD0icGJrZGYyLXNjcmlwdCI+CiAgICAKCmNvbnN0IHRvVTggPSAodikgPT4gKHYgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gdiA6IG5ldyBVaW50OEFycmF5KHYpKTsKY29uc3QgY29uY2F0ID0gKGEsIGIpID0+IHsKICBjb25zdCBvdXQgPSBuZXcgVWludDhBcnJheShhLmxlbmd0aCArIGIubGVuZ3RoKTsKICBvdXQuc2V0KGEsIDApOwogIG91dC5zZXQoYiwgYS5sZW5ndGgpOwogIHJldHVybiBvdXQ7Cn07CmNvbnN0IGkzMmJlID0gKHgpID0+CiAgbmV3IFVpbnQ4QXJyYXkoWwogICAgKHggPj4+IDI0KSAmIDB4ZmYsCiAgICAoeCA+Pj4gMTYpICYgMHhmZiwKICAgICh4ID4+PiA4KSAmIDB4ZmYsCiAgICB4ICYgMHhmZiwKICBdKTsKCmNvbnN0IEsgPSBuZXcgVWludDMyQXJyYXkoWwogIDB4NDI4YTJmOTgsIDB4NzEzNzQ0OTEsIDB4YjVjMGZiY2YsIDB4ZTliNWRiYTUsIDB4Mzk1NmMyNWIsIDB4NTlmMTExZjEsCiAgMHg5MjNmODJhNCwgMHhhYjFjNWVkNSwgMHhkODA3YWE5OCwgMHgxMjgzNWIwMSwgMHgyNDMxODViZSwgMHg1NTBjN2RjMywKICAweDcyYmU1ZDc0LCAweDgwZGViMWZlLCAweDliZGMwNmE3LCAweGMxOWJmMTc0LCAweGU0OWI2OWMxLCAweGVmYmU0Nzg2LAogIDB4MGZjMTlkYzYsIDB4MjQwY2ExY2MsIDB4MmRlOTJjNmYsIDB4NGE3NDg0YWEsIDB4NWNiMGE5ZGMsIDB4NzZmOTg4ZGEsCiAgMHg5ODNlNTE1MiwgMHhhODMxYzY2ZCwgMHhiMDAzMjdjOCwgMHhiZjU5N2ZjNywgMHhjNmUwMGJmMywgMHhkNWE3OTE0NywKICAweDA2Y2E2MzUxLCAweDE0MjkyOTY3LCAweDI3YjcwYTg1LCAweDJlMWIyMTM4LCAweDRkMmM2ZGZjLCAweDUzMzgwZDEzLAogIDB4NjUwYTczNTQsIDB4NzY2YTBhYmIsIDB4ODFjMmM5MmUsIDB4OTI3MjJjODUsIDB4YTJiZmU4YTEsIDB4YTgxYTY2NGIsCiAgMHhjMjRiOGI3MCwgMHhjNzZjNTFhMywgMHhkMTkyZTgxOSwgMHhkNjk5MDYyNCwgMHhmNDBlMzU4NSwgMHgxMDZhYTA3MCwKICAweDE5YTRjMTE2LCAweDFlMzc2YzA4LCAweDI3NDg3NzRjLCAweDM0YjBiY2I1LCAweDM5MWMwY2IzLCAweDRlZDhhYTRhLAogIDB4NWI5Y2NhNGYsIDB4NjgyZTZmZjMsIDB4NzQ4ZjgyZWUsIDB4NzhhNTYzNmYsIDB4ODRjODc4MTQsIDB4OGNjNzAyMDgsCiAgMHg5MGJlZmZmYSwgMHhhNDUwNmNlYiwgMHhiZWY5YTNmNywgMHhjNjcxNzhmMiwKXSk7CmNvbnN0IFJPVFIgPSAoeCwgbikgPT4gKHggPj4+IG4pIHwgKHggPDwgKDMyIC0gbikpOwpjb25zdCBDaCA9ICh4LCB5LCB6KSA9PiAoeCAmIHkpIF4gKH54ICYgeik7CmNvbnN0IE1haiA9ICh4LCB5LCB6KSA9PiAoeCAmIHkpIF4gKHggJiB6KSBeICh5ICYgeik7CmNvbnN0IFNpZ21hMCA9ICh4KSA9PiBST1RSKHgsIDIpIF4gUk9UUih4LCAxMykgXiBST1RSKHgsIDIyKTsKY29uc3QgU2lnbWExID0gKHgpID0+IFJPVFIoeCwgNikgXiBST1RSKHgsIDExKSBeIFJPVFIoeCwgMjUpOwpjb25zdCBzaWdtYTAgPSAoeCkgPT4gUk9UUih4LCA3KSBeIFJPVFIoeCwgMTgpIF4gKHggPj4+IDMpOwpjb25zdCBzaWdtYTEgPSAoeCkgPT4gUk9UUih4LCAxNykgXiBST1RSKHgsIDE5KSBeICh4ID4+PiAxMCk7CgpleHBvcnQgZnVuY3Rpb24gc2hhMjU2KG1zZ1U4KSB7CiAgY29uc3QgbSA9IHRvVTgobXNnVTgpOwogIAogIGxldCBoMCA9IDB4NmEwOWU2NjcsCiAgICBoMSA9IDB4YmI2N2FlODUsCiAgICBoMiA9IDB4M2M2ZWYzNzIsCiAgICBoMyA9IDB4YTU0ZmY1M2E7CiAgbGV0IGg0ID0gMHg1MTBlNTI3ZiwKICAgIGg1ID0gMHg5YjA1Njg4YywKICAgIGg2ID0gMHgxZjgzZDlhYiwKICAgIGg3ID0gMHg1YmUwY2QxOTsKCiAgY29uc3QgYml0TGVuSGkgPSBNYXRoLmZsb29yKChtLmxlbmd0aCAvIDB4MjAwMDAwMDApID4+PiAwKTsgCiAgY29uc3QgYml0TGVuTG8gPSAoKG0ubGVuZ3RoID4+PiAwKSAqIDgpID4+PiAwOyAKICBjb25zdCBrID0gLShtLmxlbmd0aCArIDkpICYgNjM7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkobS5sZW5ndGggKyAxICsgayArIDgpOwogIHBhZGRlZC5zZXQobSwgMCk7CiAgcGFkZGVkW20ubGVuZ3RoXSA9IDB4ODA7CiAgCiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSA4XSA9IChiaXRMZW5IaSA+Pj4gMjQpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDddID0gKGJpdExlbkhpID4+PiAxNikgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gNl0gPSAoYml0TGVuSGkgPj4+IDgpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDVdID0gYml0TGVuSGkgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gNF0gPSAoYml0TGVuTG8gPj4+IDI0KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSAzXSA9IChiaXRMZW5MbyA+Pj4gMTYpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDJdID0gKGJpdExlbkxvID4+PiA4KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSAxXSA9IGJpdExlbkxvICYgMHhmZjsKCiAgY29uc3QgVyA9IG5ldyBVaW50MzJBcnJheSg2NCk7CgogIGZvciAobGV0IG9mZiA9IDA7IG9mZiA8IHBhZGRlZC5sZW5ndGg7IG9mZiArPSA2NCkgewogICAgCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHsKICAgICAgY29uc3QgaiA9IG9mZiArIChpIDw8IDIpOwogICAgICBXW2ldID0KICAgICAgICAocGFkZGVkW2pdIDw8IDI0KSB8CiAgICAgICAgKHBhZGRlZFtqICsgMV0gPDwgMTYpIHwKICAgICAgICAocGFkZGVkW2ogKyAyXSA8PCA4KSB8CiAgICAgICAgcGFkZGVkW2ogKyAzXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxNjsgaSA8IDY0OyBpKyspIHsKICAgICAgV1tpXSA9CiAgICAgICAgKHNpZ21hMShXW2kgLSAyXSkgKyBXW2kgLSA3XSArIHNpZ21hMChXW2kgLSAxNV0pICsgV1tpIC0gMTZdKSA+Pj4gMDsKICAgIH0KCiAgICBsZXQgYSA9IGgwLAogICAgICBiID0gaDEsCiAgICAgIGMgPSBoMiwKICAgICAgZCA9IGgzLAogICAgICBlID0gaDQsCiAgICAgIGYgPSBoNSwKICAgICAgZyA9IGg2LAogICAgICBoID0gaDc7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2NDsgaSsrKSB7CiAgICAgIGNvbnN0IHQxID0gKGggKyBTaWdtYTEoZSkgKyBDaChlLCBmLCBnKSArIEtbaV0gKyBXW2ldKSA+Pj4gMDsKICAgICAgY29uc3QgdDIgPSAoU2lnbWEwKGEpICsgTWFqKGEsIGIsIGMpKSA+Pj4gMDsKICAgICAgaCA9IGc7CiAgICAgIGcgPSBmOwogICAgICBmID0gZTsKICAgICAgZSA9IChkICsgdDEpID4+PiAwOwogICAgICBkID0gYzsKICAgICAgYyA9IGI7CiAgICAgIGIgPSBhOwogICAgICBhID0gKHQxICsgdDIpID4+PiAwOwogICAgfQoKICAgIGgwID0gKGgwICsgYSkgPj4+IDA7CiAgICBoMSA9IChoMSArIGIpID4+PiAwOwogICAgaDIgPSAoaDIgKyBjKSA+Pj4gMDsKICAgIGgzID0gKGgzICsgZCkgPj4+IDA7CiAgICBoNCA9IChoNCArIGUpID4+PiAwOwogICAgaDUgPSAoaDUgKyBmKSA+Pj4gMDsKICAgIGg2ID0gKGg2ICsgZykgPj4+IDA7CiAgICBoNyA9IChoNyArIGgpID4+PiAwOwogIH0KCiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoMzIpOwogIGNvbnN0IEggPSBbaDAsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGg3XTsKICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgb3V0LnNldChpMzJiZShIW2ldKSwgaSAqIDQpOwogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIG1ha2VIbWFjU2hhMjU2KGtleSkgewogIGtleSA9IHRvVTgoa2V5KTsKICBjb25zdCBibG9jayA9IDY0OwogIGlmIChrZXkubGVuZ3RoID4gYmxvY2spIGtleSA9IHNoYTI1NihrZXkpOwogIGlmIChrZXkubGVuZ3RoIDwgYmxvY2spIHsKICAgIGNvbnN0IGsgPSBuZXcgVWludDhBcnJheShibG9jayk7CiAgICBrLnNldChrZXkpOwogICAga2V5ID0gazsKICB9CiAgY29uc3QgaXBhZCA9IG5ldyBVaW50OEFycmF5KGJsb2NrKTsKICBjb25zdCBvcGFkID0gbmV3IFVpbnQ4QXJyYXkoYmxvY2spOwogIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2s7IGkrKykgewogICAgaXBhZFtpXSA9IGtleVtpXSBeIDB4MzY7CiAgICBvcGFkW2ldID0ga2V5W2ldIF4gMHg1YzsKICB9CiAgcmV0dXJuIChtc2cpID0+IHNoYTI1Nihjb25jYXQob3BhZCwgc2hhMjU2KGNvbmNhdChpcGFkLCB0b1U4KG1zZykpKSkpOwp9CgpleHBvcnQgZnVuY3Rpb24gcGJrZGYyU2hhMjU2KHsgcGFzc3dvcmQsIHNhbHQsIGl0ZXJhdGlvbnMsIGRrTGVuIH0pIHsKICBjb25zdCBQID0gdG9VOChwYXNzd29yZCk7CiAgY29uc3QgUyA9IHRvVTgoc2FsdCk7CiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGl0ZXJhdGlvbnMpIHx8IGl0ZXJhdGlvbnMgPD0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJpdGVyYXRpb25zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7CiAgfQogIGlmICghTnVtYmVyLmlzSW50ZWdlcihka0xlbikgfHwgZGtMZW4gPD0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJka0xlbiBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpOwogIH0KCiAgY29uc3QgaExlbiA9IDMyOyAKICBjb25zdCBsID0gTWF0aC5jZWlsKGRrTGVuIC8gaExlbik7CiAgY29uc3QgciA9IGRrTGVuIC0gKGwgLSAxKSAqIGhMZW47CgogIGNvbnN0IFBSRiA9IG1ha2VIbWFjU2hhMjU2KFApOwogIGNvbnN0IERLID0gbmV3IFVpbnQ4QXJyYXkoZGtMZW4pOwogIGNvbnN0IGJsb2NrQnVmID0gbmV3IFVpbnQ4QXJyYXkoaExlbik7IAoKICBmb3IgKGxldCBpID0gMTsgaSA8PSBsOyBpKyspIHsKICAgIAogICAgY29uc3QgVTEgPSBQUkYoY29uY2F0KFMsIGkzMmJlKGkpKSk7CiAgICBibG9ja0J1Zi5zZXQoVTEpOwogICAgbGV0IFVwcmV2ID0gVTE7CiAgICBmb3IgKGxldCBqID0gMjsgaiA8PSBpdGVyYXRpb25zOyBqKyspIHsKICAgICAgVXByZXYgPSBQUkYoVXByZXYpOwogICAgICBmb3IgKGxldCBrID0gMDsgayA8IGhMZW47IGsrKykgYmxvY2tCdWZba10gXj0gVXByZXZba107CiAgICB9CiAgICBjb25zdCBvZmZzZXQgPSAoaSAtIDEpICogaExlbjsKICAgIERLLnNldChibG9ja0J1Zi5zdWJhcnJheSgwLCBpID09PSBsID8gciA6IGhMZW4pLCBvZmZzZXQpOwogIH0KICAKICBibG9ja0J1Zi5maWxsKDApOwogIHJldHVybiBESzsKfQoKZXhwb3J0IGZ1bmN0aW9uIHBia2RmMlNoYTI1NkhleChvcHRzKSB7CiAgY29uc3Qgb3V0ID0gcGJrZGYyU2hhMjU2KG9wdHMpOwogIHJldHVybiBbLi4ub3V0XS5tYXAoKGIpID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpLmpvaW4oIiIpOwp9CgogIDwvc2NyaXB0PgoKICA8c2NyaXB0IHR5cGU9Im1vZHVsZSI+CgogICAgY29uc3QgJCA9IChzKSA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHMpOwoKICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRJbmxpbmVNb2R1bGUoaWQpIHsKICAgICAgY29uc3QgY29kZSA9ICQoJyMnICsgaWQpLnRleHRDb250ZW50OwogICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtjb2RlXSwgeyB0eXBlOiAndGV4dC9qYXZhc2NyaXB0JyB9KSk7CiAgICAgIHJldHVybiB7IG1vZHVsZTogYXdhaXQgaW1wb3J0KHVybCksIGNvZGUgfTsKICAgIH0KCiAgICBjb25zdCBhZXMyNTZnY20gPSBhd2FpdCBsb2FkSW5saW5lTW9kdWxlKCdhZXMyNTZnY20tc2NyaXB0Jyk7CiAgICBjb25zdCBwYmtkZjIgPSBhd2FpdCBsb2FkSW5saW5lTW9kdWxlKCdwYmtkZjItc2NyaXB0Jyk7CgogICAgY29uc3QgREVDT0RFX1RFTVBMQVRFID0gJCgiI2RlY29kZS10ZW1wbGF0ZSIpLmlubmVySFRNTDsKCiAgICAvLyAtLS0gaGVscGVycyAtLS0KICAgIGNvbnN0IGVuYyA9IG5ldyBUZXh0RW5jb2RlcigpOwogICAgY29uc3QgYjY0ID0gKGJ1ZikgPT4gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLm5ldyBVaW50OEFycmF5KGJ1ZikpKTsKICAgIGNvbnN0IHJhbmQgPSAobikgPT4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheShuKSk7CgogICAgYXN5bmMgZnVuY3Rpb24gZW5jcnlwdFNlY3JldChzZWNyZXQsIHBhc3N3b3JkLCBpdGVyYXRpb25zKSB7CiAgICAgIGNvbnN0IHNhbHQgPSByYW5kKDE2KTsKICAgICAgY29uc3QgaXYgPSByYW5kKDEyKTsKICAgICAgLy8gc3VidGxlIGlzIG5vdCBhdmFpbGFibGUgaW4gZGF0YSB1cmxzLiB1c2UgcHVyZSBKUyBpbXBsZW1lbnRhdGlvbnMuCiAgICAgIC8vIERlcml2ZSBrZXkgdXNpbmcgUEJLREYyCiAgICAgIGNvbnN0IGtleSA9IHBia2RmMi5tb2R1bGUucGJrZGYyU2hhMjU2KHsKICAgICAgICBwYXNzd29yZDogZW5jLmVuY29kZShwYXNzd29yZCksCiAgICAgICAgc2FsdDogc2FsdCwKICAgICAgICBpdGVyYXRpb25zOiBpdGVyYXRpb25zLAogICAgICAgIGRrTGVuOiAzMiAvLyAyNTYgYml0cyBmb3IgQUVTLTI1NgogICAgICB9KTsKCiAgICAgIC8vIEVuY3J5cHQgdXNpbmcgQUVTLUdDTQogICAgICBjb25zdCB7IGNpcGhlcnRleHQsIHRhZyB9ID0gYWVzMjU2Z2NtLm1vZHVsZS5hZXMyNTZHY21FbmNyeXB0KHsKICAgICAgICBrZXk6IGtleSwKICAgICAgICBpdjogaXYsCiAgICAgICAgcGxhaW50ZXh0OiBlbmMuZW5jb2RlKHNlY3JldCkKICAgICAgfSk7CgogICAgICByZXR1cm4geyBjdEI2NDogYjY0KGNpcGhlcnRleHQpLCBpdkI2NDogYjY0KGl2KSwgc2FsdEI2NDogYjY0KHNhbHQpLCB0YWdCNjQ6IGI2NCh0YWcpIH07CiAgICB9CgogICAgZnVuY3Rpb24gYnVpbGREZWNvZGVIVE1MKHRlbXBsYXRlLCB7IGN0QjY0LCBpdkI2NCwgc2FsdEI2NCwgdGFnQjY0IH0sIGl0ZXJhdGlvbnMpIHsKICAgICAgcmV0dXJuIHRlbXBsYXRlCiAgICAgICAgLnJlcGxhY2VBbGwoIl9fQ0lQSEVSVEVYVF9CNjRfXyIsIGN0QjY0KQogICAgICAgIC5yZXBsYWNlQWxsKCJfX0lWX0I2NF9fIiwgaXZCNjQpCiAgICAgICAgLnJlcGxhY2VBbGwoIl9fU0FMVF9CNjRfXyIsIHNhbHRCNjQpCiAgICAgICAgLnJlcGxhY2VBbGwoIl9fVEFHX0I2NF9fIiwgdGFnQjY0KQogICAgICAgIC5yZXBsYWNlQWxsKCJfX0lURVJBVElPTlNfXyIsIFN0cmluZyhpdGVyYXRpb25zKSkKICAgICAgICAucmVwbGFjZUFsbCgiX19JTkNMVURFX0FFUzI1NkdDTV9KU18yX18iLCBhZXMyNTZnY20uY29kZSkKICAgICAgICAucmVwbGFjZUFsbCgiX19JTkNMVURFX1BCS0RGMl9KU18yX18iLCBwYmtkZjIuY29kZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9EYXRhVVJMKGh0bWwpIHsKICAgICAgLy8gQmFzZTY0LWVuY29kZSBVVEYtOCBzYWZlbHkKICAgICAgY29uc3QgdXRmOCA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShodG1sKTsKICAgICAgbGV0IHMgPSAiIjsKICAgICAgZm9yIChjb25zdCBjIG9mIHV0ZjgpIHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTsKICAgICAgY29uc3QgYjY0ID0gYnRvYShzKTsKICAgICAgcmV0dXJuIGBkYXRhOnRleHQvaHRtbDtiYXNlNjQsJHtiNjR9YDsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBjb3B5VG9DbGlwYm9hcmQodGV4dCwgYnV0dG9uKSB7CiAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGJ1dHRvbi50ZXh0Q29udGVudDsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgICAgIHRleHRhcmVhLnZhbHVlID0gdGV4dDsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRhcmVhKTsKICAgICAgICB0ZXh0YXJlYS5zZWxlY3QoKTsKICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGV4dGFyZWEpOwogICAgICB9CiAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICJDb3BpZWQhIjsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0OwogICAgICB9LCAyMDAwKTsKICAgIH0KCiAgICAkKCIjY29weS1wdyIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICBjb25zdCBwdyA9ICQoIiNwdyIpLnZhbHVlOwogICAgICBpZiAocHcpIGNvcHlUb0NsaXBib2FyZChwdywgJCgiI2NvcHktcHciKSk7CiAgICB9KTsKCiAgICAkKCIjY29weS11cmwiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgY29uc3QgdXJsID0gJCgiI3VybCIpLnRleHRDb250ZW50OwogICAgICBpZiAodXJsICYmIHVybCAhPT0gIkVuY3J5cHRpbmcuLi4iICYmICF1cmwuc3RhcnRzV2l0aCgiRXJyb3I6IikpIHsKICAgICAgICBjb3B5VG9DbGlwYm9hcmQodXJsLCAkKCIjY29weS11cmwiKSk7CiAgICAgIH0KICAgIH0pOwoKICAgICQoIiNnZW5lcmF0ZS1wdyIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICBjb25zdCBwdyA9IGI2NChyYW5kKDI0KSkucmVwbGFjZSgvXCsvZywgJ0EnKS5yZXBsYWNlKC9cLy9nLCAnQicpLnJlcGxhY2UoLz0vZywgJycpOwogICAgICAkKCIjcHciKS52YWx1ZSA9IHB3OwogICAgfSk7CgogICAgJCgiI2dvIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBhc3luYyAoKSA9PiB7CiAgICAgIGNvbnN0IHNlY3JldCA9ICgkKCIjc2VjcmV0IikudmFsdWUgfHwgIiIpOwogICAgICBjb25zdCBwdyA9ICgkKCIjcHciKS52YWx1ZSB8fCAiIik7CiAgICAgIGNvbnN0IGl0ZXJzID0gNTAwXzAwMDsKICAgICAgY29uc3Qgb3V0ID0gJCgiI3VybCIpOwogICAgICBjb25zdCBjb3B5VXJsQnRuID0gJCgiI2NvcHktdXJsIik7CgogICAgICBpZiAoIXB3KSB7IG91dC50ZXh0Q29udGVudCA9ICJQbGVhc2UgZW50ZXIgYSBwYXNzd29yZC4iOyByZXR1cm47IH0KCiAgICAgIG91dC50ZXh0Q29udGVudCA9ICJFbmNyeXB0aW5nLi4uIjsKICAgICAgY29weVVybEJ0bi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgZW5jcnlwdFNlY3JldChzZWNyZXQsIHB3LCBpdGVycyk7CiAgICAgICAgY29uc3QgZGVjb2RlSFRNTCA9IGJ1aWxkRGVjb2RlSFRNTChERUNPREVfVEVNUExBVEUsIHBheWxvYWQsIGl0ZXJzKTsKICAgICAgICBjb25zdCB1cmwgPSB0b0RhdGFVUkwoZGVjb2RlSFRNTCk7CiAgICAgICAgb3V0LnRleHRDb250ZW50ID0gdXJsOwogICAgICAgIGNvcHlVcmxCdG4uc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBvdXQudGV4dENvbnRlbnQgPSBgRXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YDsKICAgICAgICBjb3B5VXJsQnRuLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIH0KICAgIH0pOwogIDwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+
```