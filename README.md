# CipherLink - Self contained data url based secret sharing tool

## Overview

This tool lets you share secret with a password or key with zero infrastructure and only requires a browser. It doesnt even require a network connection. It is not audited, and just for fun, I make no guarentees on security and take no responsibility anything you do with it.

## How to use

Build it by running build.py. Or use the build output url at the end of this readme. Input your secret message, and a password and generate a shareable url (it will be big). Send that url to the recipient. Then, on a different channel, send the password. Eg, send the data url by email, and password on whatsapp, set to disappear. Always build the url yourself or get it from this readme.

## Security Notes

- Crypto was all re-implemented in js, because there's no crypto.subtle in the data url context in browsers. Yes, I could have used an audited implementation, but this is for fun. Theres is a small test script that does a few simple sanity checks.
- There's no point sending the url and password over the same channel. You're sending plain text at that point.
- It would be cool to write this as a quine, so someone who receives a message could then send their own message. But it's better to link them to somewhere to get the trusted intitial data url.

# URL
Copy this url into your browser bar to use the tool:
Password tool:
```url
data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+Q2lwaGVyTGluazwvdGl0bGU+CjxzdHlsZT4KICBib2R5IHsKICAgIGZvbnQtZmFtaWx5OiBzeXN0ZW0tdWksIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgbWFyZ2luOiAycmVtOwogICAgbGluZS1oZWlnaHQ6IDEuNAogIH0KCiAgdGV4dGFyZWEgewogICAgd2lkdGg6IDEwMCU7CiAgICBtaW4taGVpZ2h0OiA4cmVtCiAgfQoKICBpbnB1dCwKICBidXR0b24sCiAgdGV4dGFyZWEgewogICAgZm9udDogaW5oZXJpdDsKICAgIHBhZGRpbmc6IC41cmVtOwogICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsKICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgfQoKICBidXR0b24gewogICAgY3Vyc29yOiBwb2ludGVyCiAgfQoKICAucm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBnYXA6IC41cmVtOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbjogLjVyZW0gMAogIH0KCiAgLm91dCB7CiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICBib3JkZXI6IDFweCBkYXNoZWQgI2RkZDsKICAgIHBhZGRpbmc6IDFyZW07CiAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgIGJhY2tncm91bmQ6ICNmYWZhZmE7CiAgICB3b3JkLWJyZWFrOiBicmVhay1hbGwKICB9Cjwvc3R5bGU+Cgo8Ym9keT4KICA8aDE+Q2lwaGVyTGluazwvaDE+CiAgPHA+U2VuZCBzZWNyZXRzIHdpdGggYSBTZWxmLWNvbnRhaW5lZCBkYXRhIFVSTCB1c2luZyBQQktERjIgKyBBRVMtR0NNLjwvcD4KICA8cD4KICAgIDxzdHJvbmc+V2FybmluZzo8L3N0cm9uZz4gVXNlIHRoaXMgdG9vbCBhdCB5b3VyIG93biByaXNrLiBBbHdheXMgZW5zdXJlIHlvdSBnb3QgdGhlIGxpbmsgZnJvbQogICAgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2hpbGxhYy9DaXBoZXJMaW5rIj5odHRwczovL2dpdGh1Yi5jb20vaGlsbGFjL0NpcGhlckxpbms8L2E+IGFuZCB2ZXQgdGhlIGNvZGUgeW91cnNlbGYuCiAgPC9wPgogIDxwPk1ha2Ugc3VyZSB0byB1c2UgYSBzdHJvbmcgcGFzc3dvcmQuIFRoaXMgdG9vbCBkb2VzIG5vdCBlbmZvcmNlIGFueSBwYXNzd29yZCBzdHJlbmd0aCByZXF1aXJlbWVudHMuPC9wPgogIDxwPk1ha2Ugc3VyZSB5b3Ugc2VuZCB0aGUgcGFzc3dvcmQgb3ZlciBhIGRpZmZlcmVudCBjaGFubmVsIHRvIHRoZSBkYXRhIHVybC4gT3IgZWxzZSB5b3UncmUganVzdCBzZW5kaW5nIHBsYWluIHRleHQuCiAgICBFZyBzZW5kIGRhdGEgdXJsIG9uIGVtYWlsIGFuZCBwYXNzd29yZCBvbiB3aGF0c2FwcCBhcyBhIGRpc2FwcGVlcmluZyBtZXNzYWdlLjwvcD4KCiAgPGxhYmVsPlNlY3JldDwvbGFiZWw+CiAgPHRleHRhcmVhIGlkPSJzZWNyZXQiIHBsYWNlaG9sZGVyPSJUeXBlIHlvdXIgc2VjcmV0IGhlcmUuLi4iPjwvdGV4dGFyZWE+CgogIDxkaXYgY2xhc3M9InJvdyI+CiAgICA8bGFiZWwgZm9yPSJwdyI+UGFzc3dvcmQ6PC9sYWJlbD4KICAgIDxpbnB1dCBpZD0icHciIHR5cGU9InBhc3N3b3JkIiBwbGFjZWhvbGRlcj0iUGFzc3dvcmQiIC8+CiAgICA8YnV0dG9uIGlkPSJnZW5lcmF0ZS1wdyI+R2VuIHN0cm9uZyBwYXNzd29yZDwvYnV0dG9uPgogIDwvZGl2PgogIDxidXR0b24gaWQ9ImdvIj5FbmNyeXB0IG1lc3NhZ2U8L2J1dHRvbj4KCiAgPGgzPk91dHB1dDwvaDM+CiAgPGRpdiBjbGFzcz0icm93Ij4KICAgIDxidXR0b24gaWQ9ImNvcHktcHciIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImNvcHktYnRuIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDAuNXJlbTsiPkNvcHkgUGFzc3dvcmQ8L2J1dHRvbj4KICAgIDxidXR0b24gaWQ9ImNvcHktdXJsIiBjbGFzcz0iY29weS1idG4iIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+Q29weSBVUkw8L2J1dHRvbj4KICA8L2Rpdj4KCiAgPGRpdiBpZD0idXJsIiBjbGFzcz0ib3V0Ij48L2Rpdj4KCiAgPHRlbXBsYXRlIGlkPSJkZWNvZGUtdGVtcGxhdGUiPgogICAgPCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+Q2lwaGVyTGluazwvdGl0bGU+CjxzdHlsZT4KICAgIGJvZHkgewogICAgICAgIGZvbnQtZmFtaWx5OiBzeXN0ZW0tdWksIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgIG1hcmdpbjogMnJlbTsKICAgICAgICBsaW5lLWhlaWdodDogMS40CiAgICB9CgogICAgaW5wdXQsCiAgICBidXR0b24sCiAgICB0ZXh0YXJlYSB7CiAgICAgICAgZm9udDogaW5oZXJpdDsKICAgICAgICBwYWRkaW5nOiAuNXJlbTsKICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogICAgICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgICB9CgogICAgYnV0dG9uIHsKICAgICAgICBjdXJzb3I6IHBvaW50ZXIKICAgIH0KCiAgICAucm93IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGdhcDogLjVyZW07CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBtYXJnaW46IC41cmVtIDAKICAgIH0KCiAgICAub3V0IHsKICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgYm9yZGVyOiAxcHggZGFzaGVkICNkZGQ7CiAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhCiAgICB9Cjwvc3R5bGU+Cgo8Ym9keT4KICAgIDxoMT5DaXBoZXJMaW5rPC9oMT4KICAgIDxwPkVudGVyIHBhc3N3b3JkIHRvIGRlY3J5cHQ8L3A+CiAgICA8Zm9ybSBpZD0iZm9ybSI+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgPGlucHV0IGlkPSJwdyIgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJQYXNzd29yZCIgcmVxdWlyZWQgLz4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkRlY3J5cHQ8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZm9ybT4KICAgIDxkaXYgaWQ9InN0YXR1cyI+PC9kaXY+CiAgICA8cCBpZD0iYWR2ZXJ0IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPklmIHlvdSB3YW50IHRvIHVzZSB0aGlzIHRvb2wgdG8gc2VuZCBzZWNyZXRzIHlvdXJzZWxmLCBnbyB0byA8YQogICAgICAgICAgICBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vaGlsbGFjL0NpcGhlckxpbmsiPmh0dHBzOi8vZ2l0aHViLmNvbS9oaWxsYWMvQ2lwaGVyTGluazwvYT48L3A+CgogICAgPGgzPlJlc3VsdDwvaDM+CiAgICA8ZGl2IGlkPSJvdXQiIGNsYXNzPSJvdXQiPjwvZGl2PgoKICAgIDxzY3JpcHQgdHlwZT0ibW9kdWxlLXNvdXJjZSIgaWQ9ImFlczI1NmdjbS1zY3JpcHQiPgogICAgICAgIF9fSU5DTFVERV9BRVMyNTZHQ01fSlNfMl9fCiAgICA8L3NjcmlwdD4KCiAgICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJwYmtkZjItc2NyaXB0Ij4KICAgICAgICBfX0lOQ0xVREVfUEJLREYyX0pTXzJfXwogICAgPC9zY3JpcHQ+CgogICAgPHNjcmlwdCB0eXBlPSJtb2R1bGUiPgogICAgICAgIGNvbnN0ICQgPSAocykgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKTsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gbG9hZElubGluZU1vZHVsZShpZCkgewogICAgICAgICAgICBjb25zdCBjb2RlID0gJCgnIycgKyBpZCkudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6ICd0ZXh0L2phdmFzY3JpcHQnIH0pKTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGltcG9ydCh1cmwpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYWVzMjU2Z2NtID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgnYWVzMjU2Z2NtLXNjcmlwdCcpOwogICAgICAgIGNvbnN0IHBia2RmMiA9IGF3YWl0IGxvYWRJbmxpbmVNb2R1bGUoJ3Bia2RmMi1zY3JpcHQnKTsKCiAgICAgICAgLy8gPT09IEZpbGxlZCBieSB0aGUgZ2VuZXJhdG9yID09PQogICAgICAgIGNvbnN0IENJUEhFUlRFWFRfQjY0ID0gIl9fQ0lQSEVSVEVYVF9CNjRfXyI7CiAgICAgICAgY29uc3QgSVZfQjY0ID0gIl9fSVZfQjY0X18iOwogICAgICAgIGNvbnN0IFNBTFRfQjY0ID0gIl9fU0FMVF9CNjRfXyI7CiAgICAgICAgY29uc3QgVEFHX0I2NCA9ICJfX1RBR19CNjRfXyI7CiAgICAgICAgY29uc3QgSVRFUkFUSU9OUyA9IF9fSVRFUkFUSU9OU19fOwoKICAgICAgICBjb25zdCBlbmMgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgICAgICBjb25zdCBkZWMgPSBuZXcgVGV4dERlY29kZXIoKTsKCiAgICAgICAgY29uc3QgYjY0VG9CeXRlcyA9IChiNjQpID0+IFVpbnQ4QXJyYXkuZnJvbShhdG9iKGI2NCksIGMgPT4gYy5jaGFyQ29kZUF0KDApKTsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGVjcnlwdFNlY3JldChwYXNzd29yZCkgewogICAgICAgICAgICBjb25zdCBzYWx0ID0gYjY0VG9CeXRlcyhTQUxUX0I2NCk7CiAgICAgICAgICAgIGNvbnN0IGl2ID0gYjY0VG9CeXRlcyhJVl9CNjQpOwogICAgICAgICAgICBjb25zdCBjaXBoZXJ0ZXh0ID0gYjY0VG9CeXRlcyhDSVBIRVJURVhUX0I2NCk7CiAgICAgICAgICAgIGNvbnN0IHRhZyA9IGI2NFRvQnl0ZXMoVEFHX0I2NCk7CgogICAgICAgICAgICAvLyBEZXJpdmUga2V5IHVzaW5nIHB1cmUgSlMgUEJLREYyCiAgICAgICAgICAgIGNvbnN0IGtleSA9IHBia2RmMi5wYmtkZjJTaGEyNTYoewogICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGVuYy5lbmNvZGUocGFzc3dvcmQpLAogICAgICAgICAgICAgICAgc2FsdDogc2FsdCwKICAgICAgICAgICAgICAgIGl0ZXJhdGlvbnM6IElURVJBVElPTlMsCiAgICAgICAgICAgICAgICBka0xlbjogMzIgLy8gMjU2IGJpdHMgZm9yIEFFUy0yNTYKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gRGVjcnlwdCB1c2luZyBBRVMtR0NNCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhZXMyNTZnY20uYWVzMjU2R2NtRGVjcnlwdCh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgICAgaXY6IGl2LAogICAgICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IGNpcGhlcnRleHQsCiAgICAgICAgICAgICAgICAgICAgdGFnOiB0YWcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0Lm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJEZWNyeXB0aW9uIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBkZWMuZGVjb2RlKHJlc3VsdC5wbGFpbnRleHQpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRlY3J5cHRpb24gZmFpbGVkICh3cm9uZyBwYXNzd29yZCBvciBjb3JydXB0ZWQgZGF0YSkuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICQoIiNmb3JtIikuYWRkRXZlbnRMaXN0ZW5lcigic3VibWl0IiwgYXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBzdGF0dXMgPSAkKCIjc3RhdHVzIik7CiAgICAgICAgICAgIGNvbnN0IG91dCA9ICQoIiNvdXQiKTsKICAgICAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gIkRlY3J5cHRpbmcuLi4iOwogICAgICAgICAgICBvdXQudGV4dENvbnRlbnQgPSAiIjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHB3ID0gJCgiI3B3IikudmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBwbGFpbnRleHQgPSBhd2FpdCBkZWNyeXB0U2VjcmV0KHB3KTsKICAgICAgICAgICAgICAgIG91dC50ZXh0Q29udGVudCA9IHBsYWludGV4dDsKICAgICAgICAgICAgICAgIHN0YXR1cy50ZXh0Q29udGVudCA9ICJTdWNjZXNzLiI7CiAgICAgICAgICAgICAgICAkKCIjYWR2ZXJ0Iikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gZXJyLm1lc3NhZ2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+CiAgPC90ZW1wbGF0ZT4KCiAgPCEtLSBub25zZW5zZSB0eXBlIHRvIGF2b2lkIGV4ZWN1dGlvbiAtLT4KICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJhZXMyNTZnY20tc2NyaXB0Ij4KICAgIAoKY29uc3QgUiA9IDB4ZTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDBuOyAKCmZ1bmN0aW9uIHRvVTgodikgewogIHJldHVybiB2IGluc3RhbmNlb2YgVWludDhBcnJheSA/IHYgOiBuZXcgVWludDhBcnJheSh2KTsKfQpmdW5jdGlvbiB4b3JCeXRlcyhhLCBiKSB7CiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoYS5sZW5ndGgpOwogIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgb3V0W2ldID0gYVtpXSBeIGJbaV07CiAgcmV0dXJuIG91dDsKfQpmdW5jdGlvbiB6ZXJvKG4pIHsKICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkobik7Cn0KCmZ1bmN0aW9uIGJ5dGVzVG9CaWdJbnRCRShiKSB7CiAgbGV0IHggPSAwbjsKICBmb3IgKGxldCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspIHggPSAoeCA8PCA4bikgfCBCaWdJbnQoYltpXSk7CiAgcmV0dXJuIHg7Cn0KZnVuY3Rpb24gYmlnSW50VG9CeXRlc0JFKHgsIGxlbikgewogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgZm9yIChsZXQgaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBvdXRbaV0gPSBOdW1iZXIoeCAmIDB4ZmZuKTsKICAgIHggPj49IDhuOwogIH0KICByZXR1cm4gb3V0Owp9Cgpjb25zdCBiNjRUb1U4ID0gKGI2NCkgPT4gVWludDhBcnJheS5mcm9tKGF0b2IoYjY0KSwgKGMpID0+IGMuY2hhckNvZGVBdCgwKSk7Cgpjb25zdCBTID0gYjY0VG9VOCgKICAiWTN4M2UvSnJiOFV3QVdjci90ZXJkc3FDeVgzNldVZndyZFNpcjV5a2NzQzMvWk1tTmovM3pEU2w1ZkZ4MkRFVkJNY2p3eGlXQlpvSEVvRGk2eWV5ZFFtRExCb2JibHFnVWp2V3N5bmpMNFJUMFFEdElQeXhXMnJMdmpsS1RGalAwTytxKzBOTk00VkYrUUovVUR5ZnFGR2pRSStTblRqMXZMYmFJUkQvODlMTkRCUHNYNWRFRjhTbmZqMWtYUmx6WUlGUDNDSXFrSWhHN3JnVTNsNEwyK0F5T2dwSkJpUmN3dE9zWXBHVjVIbm55RGR0amRWT3FXeFc5T3BsZXE0SXVuZ2xMaHltdE1ibzNYUWZTNzJMaW5BK3RXWklBL1lPWVRWWHVZYkJIWjdoK0pnUmFkbU9sSnNlaCtuT1ZTamZqS0dKRGIvbVFtaEJtUzBQc0ZTN0ZnPT0iCik7CmNvbnN0IFJjb24gPSBiNjRUb1U4KCJBQUVDQkFnUUlFQ0FHelpzMkt0Tm1nPT0iKTsKCmZ1bmN0aW9uIHJvdFdvcmQodykgewogIHJldHVybiBbd1sxXSwgd1syXSwgd1szXSwgd1swXV07Cn0KZnVuY3Rpb24gc3ViV29yZCh3KSB7CiAgcmV0dXJuIHcubWFwKCh4KSA9PiBTW3hdKTsKfQoKZnVuY3Rpb24ga2V5RXhwYW5kMjU2KGtleSkgewogIGtleSA9IHRvVTgoa2V5KTsKICBpZiAoa2V5Lmxlbmd0aCAhPT0gMzIpIHRocm93IG5ldyBFcnJvcigiQUVTLTI1NiBrZXkgbXVzdCBiZSAzMiBieXRlcyIpOwoKICBjb25zdCBOayA9IDgsCiAgICBOYiA9IDQsCiAgICBOciA9IDE0OwogIGNvbnN0IHcgPSBuZXcgVWludDhBcnJheShOYiAqIChOciArIDEpICogNCk7CiAgdy5zZXQoa2V5KTsKICBjb25zdCB0ZW1wID0gWzAsIDAsIDAsIDBdOwogIGxldCBieXRlc0dlbmVyYXRlZCA9IDMyOwogIGxldCByY29uSXRlciA9IDE7CgogIHdoaWxlIChieXRlc0dlbmVyYXRlZCA8IHcubGVuZ3RoKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgdGVtcFtpXSA9IHdbYnl0ZXNHZW5lcmF0ZWQgLSA0ICsgaV07CiAgICBpZiAoKGJ5dGVzR2VuZXJhdGVkIC8gNCkgJSBOayA9PT0gMCkgewogICAgICBsZXQgdCA9IHJvdFdvcmQodGVtcCk7CiAgICAgIHQgPSBzdWJXb3JkKHQpOwogICAgICB0WzBdIF49IFJjb25bcmNvbkl0ZXIrK107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB0ZW1wW2ldID0gdFtpXTsKICAgIH0gZWxzZSBpZiAoKGJ5dGVzR2VuZXJhdGVkIC8gNCkgJSBOayA9PT0gNCkgewogICAgICBsZXQgdCA9IHN1YldvcmQodGVtcCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB0ZW1wW2ldID0gdFtpXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgIHdbYnl0ZXNHZW5lcmF0ZWRdID0gd1tieXRlc0dlbmVyYXRlZCAtIDMyXSBeIHRlbXBbaV07CiAgICAgIGJ5dGVzR2VuZXJhdGVkKys7CiAgICB9CiAgfQogIHJldHVybiB3OyAKfQoKZnVuY3Rpb24gYWRkUm91bmRLZXkocywgcmssIHJvdW5kKSB7CiAgZm9yIChsZXQgYyA9IDA7IGMgPCA0OyBjKyspIHsKICAgIHNbMCArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAwXTsKICAgIHNbMSArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAxXTsKICAgIHNbMiArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAyXTsKICAgIHNbMyArIDQgKiBjXSBePSBya1tyb3VuZCAqIDE2ICsgNCAqIGMgKyAzXTsKICB9Cn0KZnVuY3Rpb24gc3ViQnl0ZXMocykgewogIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgc1tpXSA9IFNbc1tpXV07Cn0KZnVuY3Rpb24gc2hpZnRSb3dzKHMpIHsKICBjb25zdCB0ID0gcy5zbGljZSgpOwogIHNbMV0gPSB0WzVdOwogIHNbNV0gPSB0WzldOwogIHNbOV0gPSB0WzEzXTsKICBzWzEzXSA9IHRbMV07CiAgc1syXSA9IHRbMTBdOwogIHNbNl0gPSB0WzE0XTsKICBzWzEwXSA9IHRbMl07CiAgc1sxNF0gPSB0WzZdOwogIHNbM10gPSB0WzE1XTsKICBzWzddID0gdFszXTsKICBzWzExXSA9IHRbN107CiAgc1sxNV0gPSB0WzExXTsKfQpmdW5jdGlvbiB4dGltZSh4KSB7CiAgcmV0dXJuICgoeCA8PCAxKSBeICh4ICYgMHg4MCA/IDB4MWIgOiAwKSkgJiAweGZmOwp9CmZ1bmN0aW9uIG1peENvbHVtbnMocykgewogIGZvciAobGV0IGMgPSAwOyBjIDwgNDsgYysrKSB7CiAgICBjb25zdCBpID0gNCAqIGM7CiAgICBjb25zdCBhMCA9IHNbaV0sCiAgICAgIGExID0gc1tpICsgMV0sCiAgICAgIGEyID0gc1tpICsgMl0sCiAgICAgIGEzID0gc1tpICsgM107CiAgICBjb25zdCByMCA9IHh0aW1lKGEwKSBeIChhMSBeIHh0aW1lKGExKSkgXiBhMiBeIGEzOwogICAgY29uc3QgcjEgPSBhMCBeIHh0aW1lKGExKSBeIChhMiBeIHh0aW1lKGEyKSkgXiBhMzsKICAgIGNvbnN0IHIyID0gYTAgXiBhMSBeIHh0aW1lKGEyKSBeIChhMyBeIHh0aW1lKGEzKSk7CiAgICBjb25zdCByMyA9IGEwIF4geHRpbWUoYTApIF4gYTEgXiBhMiBeIHh0aW1lKGEzKTsKICAgIHNbaV0gPSByMCAmIDB4ZmY7CiAgICBzW2kgKyAxXSA9IHIxICYgMHhmZjsKICAgIHNbaSArIDJdID0gcjIgJiAweGZmOwogICAgc1tpICsgM10gPSByMyAmIDB4ZmY7CiAgfQp9CmZ1bmN0aW9uIGFlc0VuY3J5cHRCbG9jayhyaywgYmxvY2sxNikgewogIGNvbnN0IE5yID0gMTQ7CiAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KGJsb2NrMTYpOwogIGFkZFJvdW5kS2V5KHMsIHJrLCAwKTsKICBmb3IgKGxldCByb3VuZCA9IDE7IHJvdW5kIDwgTnI7IHJvdW5kKyspIHsKICAgIHN1YkJ5dGVzKHMpOwogICAgc2hpZnRSb3dzKHMpOwogICAgbWl4Q29sdW1ucyhzKTsKICAgIGFkZFJvdW5kS2V5KHMsIHJrLCByb3VuZCk7CiAgfQogIHN1YkJ5dGVzKHMpOwogIHNoaWZ0Um93cyhzKTsKICBhZGRSb3VuZEtleShzLCByaywgTnIpOwogIHJldHVybiBzOwp9CgpmdW5jdGlvbiBpbmMzMihjb3VudGVyMTYpIHsKICBjb25zdCBvdXQgPSBjb3VudGVyMTYuc2xpY2UoKTsKICAKICBsZXQgY2FycnkgPSAxOwogIGZvciAobGV0IGkgPSAxNTsgaSA+PSAxMjsgaS0tKSB7CiAgICBjb25zdCB2ID0gKG91dFtpXSB8IDApICsgY2Fycnk7CiAgICBvdXRbaV0gPSB2ICYgMHhmZjsKICAgIGNhcnJ5ID0gdiA+Pj4gODsKICAgIGlmICghY2FycnkpIGJyZWFrOwogIH0KICByZXR1cm4gb3V0Owp9CgpmdW5jdGlvbiBnaGFzaE11bHRpcGx5KHgxMjgsIHkxMjgpIHsKICBsZXQgWiA9IDBuOwogIGxldCBWID0geTEyODsKICBmb3IgKGxldCBpID0gMDsgaSA8IDEyODsgaSsrKSB7CiAgICBjb25zdCBiaXQgPSAoeDEyOCA+PiBCaWdJbnQoMTI3IC0gaSkpICYgMW47CiAgICBpZiAoYml0KSBaIF49IFY7CiAgICBpZiAoKFYgJiAxbikgPT09IDBuKSB7CiAgICAgIFYgPj49IDFuOwogICAgfSBlbHNlIHsKICAgICAgViA9IChWID4+IDFuKSBeIFI7CiAgICB9CiAgfQogIHJldHVybiBaOwp9CgpmdW5jdGlvbiBnaGFzaChILCBBLCBDKSB7CiAgCiAgZnVuY3Rpb24gcGFkMTYodTgpIHsKICAgIGNvbnN0IHJlbSA9IHU4Lmxlbmd0aCAlIDE2OwogICAgcmV0dXJuIHJlbSA/IG5ldyBVaW50OEFycmF5KFsuLi51OCwgLi4ubmV3IFVpbnQ4QXJyYXkoMTYgLSByZW0pXSkgOiB1ODsKICB9CiAgY29uc3QgQV8gPSBwYWQxNihBKTsKICBjb25zdCBDXyA9IHBhZDE2KEMpOwoKICBsZXQgWSA9IDBuOwogIGNvbnN0IEhuID0gYnl0ZXNUb0JpZ0ludEJFKEgpOwoKICBmb3IgKGxldCBvZmYgPSAwOyBvZmYgPCBBXy5sZW5ndGg7IG9mZiArPSAxNikgewogICAgY29uc3QgWGkgPSBieXRlc1RvQmlnSW50QkUoQV8uc3ViYXJyYXkob2ZmLCBvZmYgKyAxNikpOwogICAgWSA9IGdoYXNoTXVsdGlwbHkoWSBeIFhpLCBIbik7CiAgfQogIGZvciAobGV0IG9mZiA9IDA7IG9mZiA8IENfLmxlbmd0aDsgb2ZmICs9IDE2KSB7CiAgICBjb25zdCBYaSA9IGJ5dGVzVG9CaWdJbnRCRShDXy5zdWJhcnJheShvZmYsIG9mZiArIDE2KSk7CiAgICBZID0gZ2hhc2hNdWx0aXBseShZIF4gWGksIEhuKTsKICB9CgogIGNvbnN0IGxlbkJsb2NrID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogIGNvbnN0IGFCaXRzID0gQmlnSW50KEEubGVuZ3RoKSAqIDhuOwogIGNvbnN0IGNCaXRzID0gQmlnSW50KEMubGVuZ3RoKSAqIDhuOwogIGxlbkJsb2NrLnNldChiaWdJbnRUb0J5dGVzQkUoYUJpdHMsIDgpLCAwKTsKICBsZW5CbG9jay5zZXQoYmlnSW50VG9CeXRlc0JFKGNCaXRzLCA4KSwgOCk7CgogIFkgPSBnaGFzaE11bHRpcGx5KFkgXiBieXRlc1RvQmlnSW50QkUobGVuQmxvY2spLCBIbik7CiAgcmV0dXJuIGJpZ0ludFRvQnl0ZXNCRShZLCAxNik7Cn0KCmZ1bmN0aW9uIGdjdHIocmssIGljYiwgaW5wdXQpIHsKICAKICBpZiAoaW5wdXQubGVuZ3RoID09PSAwKSByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQubGVuZ3RoKTsKICBsZXQgY3RyID0gaWNiLnNsaWNlKCk7CiAgZm9yIChsZXQgb2ZmID0gMDsgb2ZmIDwgaW5wdXQubGVuZ3RoOyBvZmYgKz0gMTYpIHsKICAgIGN0ciA9IGluYzMyKGN0cik7CiAgICBjb25zdCBrZXlzdHJlYW0gPSBhZXNFbmNyeXB0QmxvY2socmssIGN0cik7CiAgICBjb25zdCBjaHVuayA9IGlucHV0LnN1YmFycmF5KG9mZiwgTWF0aC5taW4ob2ZmICsgMTYsIGlucHV0Lmxlbmd0aCkpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVuay5sZW5ndGg7IGkrKykgewogICAgICBvdXRbb2ZmICsgaV0gPSBjaHVua1tpXSBeIGtleXN0cmVhbVtpXTsKICAgIH0KICB9CiAgcmV0dXJuIG91dDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGFlczI1NkdjbUVuY3J5cHQoewogIGtleSwKICBpdiwKICBwbGFpbnRleHQsCiAgYWFkID0gbmV3IFVpbnQ4QXJyYXkoMCksCiAgdGFnTGVuZ3RoID0gMTYsCn0pIHsKICBrZXkgPSB0b1U4KGtleSk7CiAgaXYgPSB0b1U4KGl2KTsKICBwbGFpbnRleHQgPSB0b1U4KHBsYWludGV4dCk7CiAgYWFkID0gdG9VOChhYWQpOwogIGlmIChrZXkubGVuZ3RoICE9PSAzMikgdGhyb3cgbmV3IEVycm9yKCJBRVMtMjU2IGtleSBtdXN0IGJlIDMyIGJ5dGVzIik7CiAgaWYgKHRhZ0xlbmd0aCAhPT0gMTYpCiAgICB0aHJvdyBuZXcgRXJyb3IoIk9ubHkgMTI4LWJpdCB0YWdzIHN1cHBvcnRlZCBpbiB0aGlzIHJlZmVyZW5jZSIpOwoKICBjb25zdCByayA9IGtleUV4cGFuZDI1NihrZXkpOwogIGNvbnN0IEggPSBhZXNFbmNyeXB0QmxvY2socmssIHplcm8oMTYpKTsgCgogIGxldCBKMDsKICBpZiAoaXYubGVuZ3RoID09PSAxMikgewogICAgSjAgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICBKMC5zZXQoaXYsIDApOwogICAgSjBbMTVdID0gMTsgCiAgfSBlbHNlIHsKICAgIGNvbnN0IFMgPSBnaGFzaChILCBuZXcgVWludDhBcnJheSgwKSwgaXYpOwogICAgSjAgPSBTOyAKICB9CgogIGNvbnN0IGNpcGhlcnRleHQgPSBnY3RyKHJrLCBKMCwgcGxhaW50ZXh0KTsgCiAgY29uc3QgUyA9IGdoYXNoKEgsIGFhZCwgY2lwaGVydGV4dCk7CiAgY29uc3QgdGFnID0geG9yQnl0ZXMoYWVzRW5jcnlwdEJsb2NrKHJrLCBKMCksIFMpLnN1YmFycmF5KDAsIHRhZ0xlbmd0aCk7CgogIHJldHVybiB7IGNpcGhlcnRleHQsIHRhZyB9Owp9CgpleHBvcnQgZnVuY3Rpb24gYWVzMjU2R2NtRGVjcnlwdCh7CiAga2V5LAogIGl2LAogIGNpcGhlcnRleHQsCiAgYWFkID0gbmV3IFVpbnQ4QXJyYXkoMCksCiAgdGFnLAp9KSB7CiAga2V5ID0gdG9VOChrZXkpOwogIGl2ID0gdG9VOChpdik7CiAgY2lwaGVydGV4dCA9IHRvVTgoY2lwaGVydGV4dCk7CiAgYWFkID0gdG9VOChhYWQpOwogIHRhZyA9IHRvVTgodGFnKTsKICBpZiAoa2V5Lmxlbmd0aCAhPT0gMzIpIHRocm93IG5ldyBFcnJvcigiQUVTLTI1NiBrZXkgbXVzdCBiZSAzMiBieXRlcyIpOwogIGlmICh0YWcubGVuZ3RoICE9PSAxNikKICAgIHRocm93IG5ldyBFcnJvcigiT25seSAxMjgtYml0IHRhZ3Mgc3VwcG9ydGVkIGluIHRoaXMgcmVmZXJlbmNlIik7CgogIGNvbnN0IHJrID0ga2V5RXhwYW5kMjU2KGtleSk7CiAgY29uc3QgSCA9IGFlc0VuY3J5cHRCbG9jayhyaywgemVybygxNikpOwoKICBsZXQgSjA7CiAgaWYgKGl2Lmxlbmd0aCA9PT0gMTIpIHsKICAgIEowID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgSjAuc2V0KGl2LCAwKTsKICAgIEowWzE1XSA9IDE7CiAgfSBlbHNlIHsKICAgIEowID0gZ2hhc2goSCwgbmV3IFVpbnQ4QXJyYXkoMCksIGl2KTsKICB9CgogIGNvbnN0IFMgPSBnaGFzaChILCBhYWQsIGNpcGhlcnRleHQpOwogIGNvbnN0IGV4cGVjdGVkVGFnID0geG9yQnl0ZXMoYWVzRW5jcnlwdEJsb2NrKHJrLCBKMCksIFMpLnN1YmFycmF5KAogICAgMCwKICAgIHRhZy5sZW5ndGgKICApOwoKICBpZiAoZXhwZWN0ZWRUYWcubGVuZ3RoICE9PSB0YWcubGVuZ3RoKSByZXR1cm4geyBvazogZmFsc2UsIHBsYWludGV4dDogbnVsbCB9OwogIGxldCBkaWZmID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IHRhZy5sZW5ndGg7IGkrKykgZGlmZiB8PSBleHBlY3RlZFRhZ1tpXSBeIHRhZ1tpXTsKICBpZiAoZGlmZiAhPT0gMCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBwbGFpbnRleHQ6IG51bGwgfTsKCiAgY29uc3QgcGxhaW50ZXh0ID0gZ2N0cihyaywgSjAsIGNpcGhlcnRleHQpOwogIHJldHVybiB7IG9rOiB0cnVlLCBwbGFpbnRleHQgfTsKfQoKICA8L3NjcmlwdD4KCiAgPHNjcmlwdCB0eXBlPSJtb2R1bGUtc291cmNlIiBpZD0icGJrZGYyLXNjcmlwdCI+CiAgICAKCmNvbnN0IHRvVTggPSAodikgPT4gKHYgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gdiA6IG5ldyBVaW50OEFycmF5KHYpKTsKY29uc3QgY29uY2F0ID0gKGEsIGIpID0+IHsKICBjb25zdCBvdXQgPSBuZXcgVWludDhBcnJheShhLmxlbmd0aCArIGIubGVuZ3RoKTsKICBvdXQuc2V0KGEsIDApOwogIG91dC5zZXQoYiwgYS5sZW5ndGgpOwogIHJldHVybiBvdXQ7Cn07CmNvbnN0IGkzMmJlID0gKHgpID0+CiAgbmV3IFVpbnQ4QXJyYXkoWwogICAgKHggPj4+IDI0KSAmIDB4ZmYsCiAgICAoeCA+Pj4gMTYpICYgMHhmZiwKICAgICh4ID4+PiA4KSAmIDB4ZmYsCiAgICB4ICYgMHhmZiwKICBdKTsKCmNvbnN0IEsgPSBuZXcgVWludDMyQXJyYXkoWwogIDB4NDI4YTJmOTgsIDB4NzEzNzQ0OTEsIDB4YjVjMGZiY2YsIDB4ZTliNWRiYTUsIDB4Mzk1NmMyNWIsIDB4NTlmMTExZjEsCiAgMHg5MjNmODJhNCwgMHhhYjFjNWVkNSwgMHhkODA3YWE5OCwgMHgxMjgzNWIwMSwgMHgyNDMxODViZSwgMHg1NTBjN2RjMywKICAweDcyYmU1ZDc0LCAweDgwZGViMWZlLCAweDliZGMwNmE3LCAweGMxOWJmMTc0LCAweGU0OWI2OWMxLCAweGVmYmU0Nzg2LAogIDB4MGZjMTlkYzYsIDB4MjQwY2ExY2MsIDB4MmRlOTJjNmYsIDB4NGE3NDg0YWEsIDB4NWNiMGE5ZGMsIDB4NzZmOTg4ZGEsCiAgMHg5ODNlNTE1MiwgMHhhODMxYzY2ZCwgMHhiMDAzMjdjOCwgMHhiZjU5N2ZjNywgMHhjNmUwMGJmMywgMHhkNWE3OTE0NywKICAweDA2Y2E2MzUxLCAweDE0MjkyOTY3LCAweDI3YjcwYTg1LCAweDJlMWIyMTM4LCAweDRkMmM2ZGZjLCAweDUzMzgwZDEzLAogIDB4NjUwYTczNTQsIDB4NzY2YTBhYmIsIDB4ODFjMmM5MmUsIDB4OTI3MjJjODUsIDB4YTJiZmU4YTEsIDB4YTgxYTY2NGIsCiAgMHhjMjRiOGI3MCwgMHhjNzZjNTFhMywgMHhkMTkyZTgxOSwgMHhkNjk5MDYyNCwgMHhmNDBlMzU4NSwgMHgxMDZhYTA3MCwKICAweDE5YTRjMTE2LCAweDFlMzc2YzA4LCAweDI3NDg3NzRjLCAweDM0YjBiY2I1LCAweDM5MWMwY2IzLCAweDRlZDhhYTRhLAogIDB4NWI5Y2NhNGYsIDB4NjgyZTZmZjMsIDB4NzQ4ZjgyZWUsIDB4NzhhNTYzNmYsIDB4ODRjODc4MTQsIDB4OGNjNzAyMDgsCiAgMHg5MGJlZmZmYSwgMHhhNDUwNmNlYiwgMHhiZWY5YTNmNywgMHhjNjcxNzhmMiwKXSk7CmNvbnN0IFJPVFIgPSAoeCwgbikgPT4gKHggPj4+IG4pIHwgKHggPDwgKDMyIC0gbikpOwpjb25zdCBDaCA9ICh4LCB5LCB6KSA9PiAoeCAmIHkpIF4gKH54ICYgeik7CmNvbnN0IE1haiA9ICh4LCB5LCB6KSA9PiAoeCAmIHkpIF4gKHggJiB6KSBeICh5ICYgeik7CmNvbnN0IFNpZ21hMCA9ICh4KSA9PiBST1RSKHgsIDIpIF4gUk9UUih4LCAxMykgXiBST1RSKHgsIDIyKTsKY29uc3QgU2lnbWExID0gKHgpID0+IFJPVFIoeCwgNikgXiBST1RSKHgsIDExKSBeIFJPVFIoeCwgMjUpOwpjb25zdCBzaWdtYTAgPSAoeCkgPT4gUk9UUih4LCA3KSBeIFJPVFIoeCwgMTgpIF4gKHggPj4+IDMpOwpjb25zdCBzaWdtYTEgPSAoeCkgPT4gUk9UUih4LCAxNykgXiBST1RSKHgsIDE5KSBeICh4ID4+PiAxMCk7CgpleHBvcnQgZnVuY3Rpb24gc2hhMjU2KG1zZ1U4KSB7CiAgY29uc3QgbSA9IHRvVTgobXNnVTgpOwogIAogIGxldCBoMCA9IDB4NmEwOWU2NjcsCiAgICBoMSA9IDB4YmI2N2FlODUsCiAgICBoMiA9IDB4M2M2ZWYzNzIsCiAgICBoMyA9IDB4YTU0ZmY1M2E7CiAgbGV0IGg0ID0gMHg1MTBlNTI3ZiwKICAgIGg1ID0gMHg5YjA1Njg4YywKICAgIGg2ID0gMHgxZjgzZDlhYiwKICAgIGg3ID0gMHg1YmUwY2QxOTsKCiAgY29uc3QgYml0TGVuSGkgPSBNYXRoLmZsb29yKChtLmxlbmd0aCAvIDB4MjAwMDAwMDApID4+PiAwKTsgCiAgY29uc3QgYml0TGVuTG8gPSAoKG0ubGVuZ3RoID4+PiAwKSAqIDgpID4+PiAwOyAKICBjb25zdCBrID0gLShtLmxlbmd0aCArIDkpICYgNjM7CiAgY29uc3QgcGFkZGVkID0gbmV3IFVpbnQ4QXJyYXkobS5sZW5ndGggKyAxICsgayArIDgpOwogIHBhZGRlZC5zZXQobSwgMCk7CiAgcGFkZGVkW20ubGVuZ3RoXSA9IDB4ODA7CiAgCiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSA4XSA9IChiaXRMZW5IaSA+Pj4gMjQpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDddID0gKGJpdExlbkhpID4+PiAxNikgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gNl0gPSAoYml0TGVuSGkgPj4+IDgpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDVdID0gYml0TGVuSGkgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gNF0gPSAoYml0TGVuTG8gPj4+IDI0KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSAzXSA9IChiaXRMZW5MbyA+Pj4gMTYpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDJdID0gKGJpdExlbkxvID4+PiA4KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSAxXSA9IGJpdExlbkxvICYgMHhmZjsKCiAgY29uc3QgVyA9IG5ldyBVaW50MzJBcnJheSg2NCk7CgogIGZvciAobGV0IG9mZiA9IDA7IG9mZiA8IHBhZGRlZC5sZW5ndGg7IG9mZiArPSA2NCkgewogICAgCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHsKICAgICAgY29uc3QgaiA9IG9mZiArIChpIDw8IDIpOwogICAgICBXW2ldID0KICAgICAgICAocGFkZGVkW2pdIDw8IDI0KSB8CiAgICAgICAgKHBhZGRlZFtqICsgMV0gPDwgMTYpIHwKICAgICAgICAocGFkZGVkW2ogKyAyXSA8PCA4KSB8CiAgICAgICAgcGFkZGVkW2ogKyAzXTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAxNjsgaSA8IDY0OyBpKyspIHsKICAgICAgV1tpXSA9CiAgICAgICAgKHNpZ21hMShXW2kgLSAyXSkgKyBXW2kgLSA3XSArIHNpZ21hMChXW2kgLSAxNV0pICsgV1tpIC0gMTZdKSA+Pj4gMDsKICAgIH0KCiAgICBsZXQgYSA9IGgwLAogICAgICBiID0gaDEsCiAgICAgIGMgPSBoMiwKICAgICAgZCA9IGgzLAogICAgICBlID0gaDQsCiAgICAgIGYgPSBoNSwKICAgICAgZyA9IGg2LAogICAgICBoID0gaDc7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2NDsgaSsrKSB7CiAgICAgIGNvbnN0IHQxID0gKGggKyBTaWdtYTEoZSkgKyBDaChlLCBmLCBnKSArIEtbaV0gKyBXW2ldKSA+Pj4gMDsKICAgICAgY29uc3QgdDIgPSAoU2lnbWEwKGEpICsgTWFqKGEsIGIsIGMpKSA+Pj4gMDsKICAgICAgaCA9IGc7CiAgICAgIGcgPSBmOwogICAgICBmID0gZTsKICAgICAgZSA9IChkICsgdDEpID4+PiAwOwogICAgICBkID0gYzsKICAgICAgYyA9IGI7CiAgICAgIGIgPSBhOwogICAgICBhID0gKHQxICsgdDIpID4+PiAwOwogICAgfQoKICAgIGgwID0gKGgwICsgYSkgPj4+IDA7CiAgICBoMSA9IChoMSArIGIpID4+PiAwOwogICAgaDIgPSAoaDIgKyBjKSA+Pj4gMDsKICAgIGgzID0gKGgzICsgZCkgPj4+IDA7CiAgICBoNCA9IChoNCArIGUpID4+PiAwOwogICAgaDUgPSAoaDUgKyBmKSA+Pj4gMDsKICAgIGg2ID0gKGg2ICsgZykgPj4+IDA7CiAgICBoNyA9IChoNyArIGgpID4+PiAwOwogIH0KCiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoMzIpOwogIGNvbnN0IEggPSBbaDAsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGg3XTsKICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgb3V0LnNldChpMzJiZShIW2ldKSwgaSAqIDQpOwogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIG1ha2VIbWFjU2hhMjU2KGtleSkgewogIGtleSA9IHRvVTgoa2V5KTsKICBjb25zdCBibG9jayA9IDY0OwogIGlmIChrZXkubGVuZ3RoID4gYmxvY2spIGtleSA9IHNoYTI1NihrZXkpOwogIGlmIChrZXkubGVuZ3RoIDwgYmxvY2spIHsKICAgIGNvbnN0IGsgPSBuZXcgVWludDhBcnJheShibG9jayk7CiAgICBrLnNldChrZXkpOwogICAga2V5ID0gazsKICB9CiAgY29uc3QgaXBhZCA9IG5ldyBVaW50OEFycmF5KGJsb2NrKTsKICBjb25zdCBvcGFkID0gbmV3IFVpbnQ4QXJyYXkoYmxvY2spOwogIGZvciAobGV0IGkgPSAwOyBpIDwgYmxvY2s7IGkrKykgewogICAgaXBhZFtpXSA9IGtleVtpXSBeIDB4MzY7CiAgICBvcGFkW2ldID0ga2V5W2ldIF4gMHg1YzsKICB9CiAgcmV0dXJuIChtc2cpID0+IHNoYTI1Nihjb25jYXQob3BhZCwgc2hhMjU2KGNvbmNhdChpcGFkLCB0b1U4KG1zZykpKSkpOwp9CgpleHBvcnQgZnVuY3Rpb24gbWFrZUhtYWNTaGEyNTZGbihrZXkpIHsKICBpZiAoa2V5ID09IG51bGwgfHwga2V5Lmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCJITUFDIGtleSBtdXN0IGJlIG5vbi1lbXB0eSIpOwogIGNvbnN0IGhtYWMgPSBtYWtlSG1hY1NoYTI1NihrZXkpOwogIHJldHVybiAobXNnKSA9PiBobWFjKG1zZyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBwYmtkZjJTaGEyNTYoeyBwYXNzd29yZCwgc2FsdCwgaXRlcmF0aW9ucywgZGtMZW4gfSkgewogIGNvbnN0IFAgPSB0b1U4KHBhc3N3b3JkKTsKICBjb25zdCBTID0gdG9VOChzYWx0KTsKICBpZiAoIU51bWJlci5pc0ludGVnZXIoaXRlcmF0aW9ucykgfHwgaXRlcmF0aW9ucyA8PSAwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIml0ZXJhdGlvbnMgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTsKICB9CiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGRrTGVuKSB8fCBka0xlbiA8PSAwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoImRrTGVuIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7CiAgfQoKICBjb25zdCBoTGVuID0gMzI7IAogIGNvbnN0IGwgPSBNYXRoLmNlaWwoZGtMZW4gLyBoTGVuKTsKICBjb25zdCByID0gZGtMZW4gLSAobCAtIDEpICogaExlbjsKCiAgY29uc3QgUFJGID0gbWFrZUhtYWNTaGEyNTYoUCk7CiAgY29uc3QgREsgPSBuZXcgVWludDhBcnJheShka0xlbik7CiAgY29uc3QgYmxvY2tCdWYgPSBuZXcgVWludDhBcnJheShoTGVuKTsgCgogIGZvciAobGV0IGkgPSAxOyBpIDw9IGw7IGkrKykgewogICAgCiAgICBjb25zdCBVMSA9IFBSRihjb25jYXQoUywgaTMyYmUoaSkpKTsKICAgIGJsb2NrQnVmLnNldChVMSk7CiAgICBsZXQgVXByZXYgPSBVMTsKICAgIGZvciAobGV0IGogPSAyOyBqIDw9IGl0ZXJhdGlvbnM7IGorKykgewogICAgICBVcHJldiA9IFBSRihVcHJldik7CiAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgaExlbjsgaysrKSBibG9ja0J1ZltrXSBePSBVcHJldltrXTsKICAgIH0KICAgIGNvbnN0IG9mZnNldCA9IChpIC0gMSkgKiBoTGVuOwogICAgREsuc2V0KGJsb2NrQnVmLnN1YmFycmF5KDAsIGkgPT09IGwgPyByIDogaExlbiksIG9mZnNldCk7CiAgfQogIAogIGJsb2NrQnVmLmZpbGwoMCk7CiAgcmV0dXJuIERLOwp9CgpleHBvcnQgZnVuY3Rpb24gcGJrZGYyU2hhMjU2SGV4KG9wdHMpIHsKICBjb25zdCBvdXQgPSBwYmtkZjJTaGEyNTYob3B0cyk7CiAgcmV0dXJuIFsuLi5vdXRdLm1hcCgoYikgPT4gYi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSkuam9pbigiIik7Cn0KCiAgPC9zY3JpcHQ+CgogIDxzY3JpcHQgdHlwZT0ibW9kdWxlIj4KCiAgICBjb25zdCAkID0gKHMpID0+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iocyk7CgogICAgYXN5bmMgZnVuY3Rpb24gbG9hZElubGluZU1vZHVsZShpZCkgewogICAgICBjb25zdCBjb2RlID0gJCgnIycgKyBpZCkudGV4dENvbnRlbnQ7CiAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6ICd0ZXh0L2phdmFzY3JpcHQnIH0pKTsKICAgICAgcmV0dXJuIHsgbW9kdWxlOiBhd2FpdCBpbXBvcnQodXJsKSwgY29kZSB9OwogICAgfQoKICAgIGNvbnN0IGFlczI1NmdjbSA9IGF3YWl0IGxvYWRJbmxpbmVNb2R1bGUoJ2FlczI1NmdjbS1zY3JpcHQnKTsKICAgIGNvbnN0IHBia2RmMiA9IGF3YWl0IGxvYWRJbmxpbmVNb2R1bGUoJ3Bia2RmMi1zY3JpcHQnKTsKCiAgICBjb25zdCBERUNPREVfVEVNUExBVEUgPSAkKCIjZGVjb2RlLXRlbXBsYXRlIikuaW5uZXJIVE1MOwoKICAgIC8vIC0tLSBoZWxwZXJzIC0tLQogICAgY29uc3QgZW5jID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICBjb25zdCBiNjQgPSAoYnVmKSA9PiBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubmV3IFVpbnQ4QXJyYXkoYnVmKSkpOwogICAgY29uc3QgcmFuZCA9IChuKSA9PiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KG4pKTsKCiAgICBhc3luYyBmdW5jdGlvbiBlbmNyeXB0U2VjcmV0KHNlY3JldCwgcGFzc3dvcmQsIGl0ZXJhdGlvbnMpIHsKICAgICAgY29uc3Qgc2FsdCA9IHJhbmQoMTYpOwogICAgICBjb25zdCBpdiA9IHJhbmQoMTIpOwogICAgICAvLyBzdWJ0bGUgaXMgbm90IGF2YWlsYWJsZSBpbiBkYXRhIHVybHMuIHVzZSBwdXJlIEpTIGltcGxlbWVudGF0aW9ucy4KICAgICAgLy8gRGVyaXZlIGtleSB1c2luZyBQQktERjIKICAgICAgY29uc3Qga2V5ID0gcGJrZGYyLm1vZHVsZS5wYmtkZjJTaGEyNTYoewogICAgICAgIHBhc3N3b3JkOiBlbmMuZW5jb2RlKHBhc3N3b3JkKSwKICAgICAgICBzYWx0OiBzYWx0LAogICAgICAgIGl0ZXJhdGlvbnM6IGl0ZXJhdGlvbnMsCiAgICAgICAgZGtMZW46IDMyIC8vIDI1NiBiaXRzIGZvciBBRVMtMjU2CiAgICAgIH0pOwoKICAgICAgLy8gRW5jcnlwdCB1c2luZyBBRVMtR0NNCiAgICAgIGNvbnN0IHsgY2lwaGVydGV4dCwgdGFnIH0gPSBhZXMyNTZnY20ubW9kdWxlLmFlczI1NkdjbUVuY3J5cHQoewogICAgICAgIGtleToga2V5LAogICAgICAgIGl2OiBpdiwKICAgICAgICBwbGFpbnRleHQ6IGVuYy5lbmNvZGUoc2VjcmV0KQogICAgICB9KTsKCiAgICAgIHJldHVybiB7IGN0QjY0OiBiNjQoY2lwaGVydGV4dCksIGl2QjY0OiBiNjQoaXYpLCBzYWx0QjY0OiBiNjQoc2FsdCksIHRhZ0I2NDogYjY0KHRhZykgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBidWlsZERlY29kZUhUTUwodGVtcGxhdGUsIHsgY3RCNjQsIGl2QjY0LCBzYWx0QjY0LCB0YWdCNjQgfSwgaXRlcmF0aW9ucykgewogICAgICByZXR1cm4gdGVtcGxhdGUKICAgICAgICAucmVwbGFjZUFsbCgiX19DSVBIRVJURVhUX0I2NF9fIiwgY3RCNjQpCiAgICAgICAgLnJlcGxhY2VBbGwoIl9fSVZfQjY0X18iLCBpdkI2NCkKICAgICAgICAucmVwbGFjZUFsbCgiX19TQUxUX0I2NF9fIiwgc2FsdEI2NCkKICAgICAgICAucmVwbGFjZUFsbCgiX19UQUdfQjY0X18iLCB0YWdCNjQpCiAgICAgICAgLnJlcGxhY2VBbGwoIl9fSVRFUkFUSU9OU19fIiwgU3RyaW5nKGl0ZXJhdGlvbnMpKQogICAgICAgIC5yZXBsYWNlQWxsKCJfX0lOQ0xVREVfQUVTMjU2R0NNX0pTXzJfXyIsIGFlczI1NmdjbS5jb2RlKQogICAgICAgIC5yZXBsYWNlQWxsKCJfX0lOQ0xVREVfUEJLREYyX0pTXzJfXyIsIHBia2RmMi5jb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0RhdGFVUkwoaHRtbCkgewogICAgICAvLyBCYXNlNjQtZW5jb2RlIFVURi04IHNhZmVseQogICAgICBjb25zdCB1dGY4ID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGh0bWwpOwogICAgICBsZXQgcyA9ICIiOwogICAgICBmb3IgKGNvbnN0IGMgb2YgdXRmOCkgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpOwogICAgICBjb25zdCBiNjQgPSBidG9hKHMpOwogICAgICByZXR1cm4gYGRhdGE6dGV4dC9odG1sO2Jhc2U2NCwke2I2NH1gOwogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIGNvcHlUb0NsaXBib2FyZCh0ZXh0LCBidXR0b24pIHsKICAgICAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gYnV0dG9uLnRleHRDb250ZW50OwogICAgICB0cnkgewogICAgICAgIGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHRleHQpOwogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7CiAgICAgICAgdGV4dGFyZWEudmFsdWUgPSB0ZXh0OwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwogICAgICAgIHRleHRhcmVhLnNlbGVjdCgpOwogICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0YXJlYSk7CiAgICAgIH0KICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gIkNvcGllZCEiOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQ7CiAgICAgIH0sIDIwMDApOwogICAgfQoKICAgICQoIiNjb3B5LXB3IikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGNvbnN0IHB3ID0gJCgiI3B3IikudmFsdWU7CiAgICAgIGlmIChwdykgY29weVRvQ2xpcGJvYXJkKHB3LCAkKCIjY29weS1wdyIpKTsKICAgIH0pOwoKICAgICQoIiNjb3B5LXVybCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICBjb25zdCB1cmwgPSAkKCIjdXJsIikudGV4dENvbnRlbnQ7CiAgICAgIGlmICh1cmwgJiYgdXJsICE9PSAiRW5jcnlwdGluZy4uLiIgJiYgIXVybC5zdGFydHNXaXRoKCJFcnJvcjoiKSkgewogICAgICAgIGNvcHlUb0NsaXBib2FyZCh1cmwsICQoIiNjb3B5LXVybCIpKTsKICAgICAgfQogICAgfSk7CgogICAgJCgiI2dlbmVyYXRlLXB3IikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGNvbnN0IHB3ID0gYjY0KHJhbmQoMjQpKS5yZXBsYWNlKC9cKy9nLCAnQScpLnJlcGxhY2UoL1wvL2csICdCJykucmVwbGFjZSgvPS9nLCAnJyk7CiAgICAgICQoIiNwdyIpLnZhbHVlID0gcHc7CiAgICB9KTsKCiAgICAkKCIjZ28iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgICAgY29uc3Qgc2VjcmV0ID0gKCQoIiNzZWNyZXQiKS52YWx1ZSB8fCAiIik7CiAgICAgIGNvbnN0IHB3ID0gKCQoIiNwdyIpLnZhbHVlIHx8ICIiKTsKICAgICAgY29uc3QgaXRlcnMgPSA1MDBfMDAwOwogICAgICBjb25zdCBvdXQgPSAkKCIjdXJsIik7CiAgICAgIGNvbnN0IGNvcHlVcmxCdG4gPSAkKCIjY29weS11cmwiKTsKCiAgICAgIGlmICghcHcpIHsgb3V0LnRleHRDb250ZW50ID0gIlBsZWFzZSBlbnRlciBhIHBhc3N3b3JkLiI7IHJldHVybjsgfQoKICAgICAgb3V0LnRleHRDb250ZW50ID0gIkVuY3J5cHRpbmcuLi4iOwogICAgICBjb3B5VXJsQnRuLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBheWxvYWQgPSBhd2FpdCBlbmNyeXB0U2VjcmV0KHNlY3JldCwgcHcsIGl0ZXJzKTsKICAgICAgICBjb25zdCBkZWNvZGVIVE1MID0gYnVpbGREZWNvZGVIVE1MKERFQ09ERV9URU1QTEFURSwgcGF5bG9hZCwgaXRlcnMpOwogICAgICAgIGNvbnN0IHVybCA9IHRvRGF0YVVSTChkZWNvZGVIVE1MKTsKICAgICAgICBvdXQudGV4dENvbnRlbnQgPSB1cmw7CiAgICAgICAgY29weVVybEJ0bi5zdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIG91dC50ZXh0Q29udGVudCA9IGBFcnJvcjogJHtlcnIubWVzc2FnZX1gOwogICAgICAgIGNvcHlVcmxCdG4uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgfQogICAgfSk7CiAgPC9zY3JpcHQ+CjwvYm9keT4KCjwvaHRtbD4=
```
Key Exchange tool:
```url
data:text/html;base64,PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+Q2lwaGVyTGluayAtIEtleSBFeGNoYW5nZTwvdGl0bGU+CjxzdHlsZT4KICBib2R5IHsKICAgIGZvbnQtZmFtaWx5OiBzeXN0ZW0tdWksIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgbWFyZ2luOiAycmVtOwogICAgbGluZS1oZWlnaHQ6IDEuNAogIH0KCiAgdGV4dGFyZWEgewogICAgd2lkdGg6IDEwMCU7CiAgICBtaW4taGVpZ2h0OiA4cmVtCiAgfQoKICBpbnB1dCwKICBidXR0b24sCiAgdGV4dGFyZWEgewogICAgZm9udDogaW5oZXJpdDsKICAgIHBhZGRpbmc6IC41cmVtOwogICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsKICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgfQoKICBidXR0b24gewogICAgY3Vyc29yOiBwb2ludGVyCiAgfQoKICAucm93IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBnYXA6IC41cmVtOwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIG1hcmdpbjogLjVyZW0gMAogIH0KCiAgLm91dCB7CiAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICBib3JkZXI6IDFweCBkYXNoZWQgI2RkZDsKICAgIHBhZGRpbmc6IDFyZW07CiAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgIGJhY2tncm91bmQ6ICNmYWZhZmE7CiAgICB3b3JkLWJyZWFrOiBicmVhay1hbGwKICB9CgogIC5oaWRkZW4gewogICAgZGlzcGxheTogbm9uZTsKICB9CgogIC5zdGVwIHsKICAgIG1hcmdpbjogMXJlbSAwOwogICAgcGFkZGluZzogMXJlbTsKICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgIGJhY2tncm91bmQ6ICNmOWY5Zjk7CiAgfQoKICAuc3RlcCBoMyB7CiAgICBtYXJnaW4tdG9wOiAwOwogIH0KPC9zdHlsZT4KCjxib2R5PgogIDxoMT5DaXBoZXJMaW5rIC0gS2V5IEV4Y2hhbmdlPC9oMT4KICA8cD5TZW5kIHNlY3JldHMgc2VjdXJlbHkgdXNpbmcgWDI1NTE5IGtleSBleGNoYW5nZSArIEFFUy1HQ00gZW5jcnlwdGlvbi48L3A+CiAgPHA+CiAgICA8c3Ryb25nPldhcm5pbmc6PC9zdHJvbmc+IFVzZSB0aGlzIHRvb2wgYXQgeW91ciBvd24gcmlzay4gQWx3YXlzIGVuc3VyZSB5b3UgZ290IHRoZSBsaW5rIGZyb20KICAgIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9oaWxsYWMvQ2lwaGVyTGluayI+aHR0cHM6Ly9naXRodWIuY29tL2hpbGxhYy9DaXBoZXJMaW5rPC9hPiBhbmQgdmV0IHRoZSBjb2RlIHlvdXJzZWxmLgogIDwvcD4KCiAgPCEtLSBTdGVwIDE6IEluaXRpYWwgbWVzc2FnZSBlbmNyeXB0aW9uIC0tPgogIDxkaXYgaWQ9InN0ZXAxIiBjbGFzcz0ic3RlcCI+CiAgICA8aDM+U3RlcCAxOiBFbnRlciB5b3VyIHNlY3JldCBtZXNzYWdlPC9oMz4KICAgIDxsYWJlbD5TZWNyZXQ8L2xhYmVsPgogICAgPHRleHRhcmVhIGlkPSJzZWNyZXQiIHBsYWNlaG9sZGVyPSJUeXBlIHlvdXIgc2VjcmV0IGhlcmUuLi4iPjwvdGV4dGFyZWE+CiAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICA8YnV0dG9uIGlkPSJlbmNyeXB0LWJ0biI+RW5jcnlwdCAmIEdlbmVyYXRlIEV4Y2hhbmdlIExpbms8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBpZD0ic2hvdy1zZWNyZXQtYnRuIiBjbGFzcz0iaGlkZGVuIj5TaG93IFNlY3JldDwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJ1cmwtb3V0cHV0IiBjbGFzcz0iaGlkZGVuIj4KICAgICAgPGg0PlNlbmQgdGhpcyBsaW5rIHRvIHRoZSByZWNpcGllbnQ6PC9oND4KICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICA8YnV0dG9uIGlkPSJjb3B5LXVybCIgY2xhc3M9ImNvcHktYnRuIj5Db3B5IEV4Y2hhbmdlIExpbms8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgaWQ9InVybCIgY2xhc3M9Im91dCI+PC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPCEtLSBTdGVwIDI6IFdhaXQgZm9yIHJlY2lwaWVudCdzIHB1YmxpYyBrZXkgLS0+CiAgPGRpdiBpZD0ic3RlcDIiIGNsYXNzPSJzdGVwIGhpZGRlbiI+CiAgICA8aDM+U3RlcCAyOiBFbnRlciByZWNpcGllbnQncyBwdWJsaWMga2V5PC9oMz4KICAgIDxwPlRoZSByZWNpcGllbnQgd2lsbCBzZW5kIHlvdSB0aGVpciBwdWJsaWMga2V5LiBQYXN0ZSBpdCBiZWxvdzo8L3A+CiAgICA8ZGl2IGNsYXNzPSJyb3ciPgogICAgICA8bGFiZWwgZm9yPSJyZWNpcGllbnQtcHVia2V5Ij5SZWNpcGllbnQncyBQdWJsaWMgS2V5OjwvbGFiZWw+CiAgICAgIDxpbnB1dCBpZD0icmVjaXBpZW50LXB1YmtleSIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9IlBhc3RlIHJlY2lwaWVudCdzIHB1YmxpYyBrZXkgaGVyZSIgLz4KICAgICAgPGJ1dHRvbiBpZD0iZ2VuZXJhdGUtZW5jcnlwdGVkLWtleSI+R2VuZXJhdGUgRW5jcnlwdGVkIEtleTwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJlbmNyeXB0ZWQta2V5LW91dHB1dCIgY2xhc3M9ImhpZGRlbiI+CiAgICAgIDxoND5TZW5kIHRoaXMgZW5jcnlwdGVkIGtleSBiYWNrIHRvIHRoZSByZWNpcGllbnQ6PC9oND4KICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICA8YnV0dG9uIGlkPSJjb3B5LWVuY3J5cHRlZC1rZXkiIGNsYXNzPSJjb3B5LWJ0biI+Q29weSBFbmNyeXB0ZWQgS2V5PC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGlkPSJlbmNyeXB0ZWQta2V5IiBjbGFzcz0ib3V0Ij48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8dGVtcGxhdGUgaWQ9ImRlY29kZS10ZW1wbGF0ZSI+CiAgICA8IWRvY3R5cGUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8bWV0YSBjaGFyc2V0PSJ1dGYtOCIgLz4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiIC8+Cjx0aXRsZT5DaXBoZXJMaW5rIC0gUmVjZWl2ZSBTZWNyZXQ8L3RpdGxlPgo8c3R5bGU+CiAgICBib2R5IHsKICAgICAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCBTZWdvZSBVSSwgUm9ib3RvLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICBtYXJnaW46IDJyZW07CiAgICAgICAgbGluZS1oZWlnaHQ6IDEuNAogICAgfQoKICAgIHRleHRhcmVhIHsKICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICBtaW4taGVpZ2h0OiA4cmVtCiAgICB9CgogICAgaW5wdXQsCiAgICBidXR0b24sCiAgICB0ZXh0YXJlYSB7CiAgICAgICAgZm9udDogaW5oZXJpdDsKICAgICAgICBwYWRkaW5nOiAuNXJlbTsKICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogICAgICAgIGJvcmRlci1yYWRpdXM6IC40cmVtCiAgICB9CgogICAgYnV0dG9uIHsKICAgICAgICBjdXJzb3I6IHBvaW50ZXIKICAgIH0KCiAgICAucm93IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGdhcDogLjVyZW07CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBtYXJnaW46IC41cmVtIDAKICAgIH0KCiAgICAub3V0IHsKICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgYm9yZGVyOiAxcHggZGFzaGVkICNkZGQ7CiAgICAgICAgcGFkZGluZzogMXJlbTsKICAgICAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgICAgICBiYWNrZ3JvdW5kOiAjZmFmYWZhOwogICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbAogICAgfQoKICAgIC5oaWRkZW4gewogICAgICAgIGRpc3BsYXk6IG5vbmU7CiAgICB9CgogICAgLnN0ZXAgewogICAgICAgIG1hcmdpbjogMXJlbSAwOwogICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICAgICAgICBib3JkZXItcmFkaXVzOiAuNXJlbTsKICAgICAgICBiYWNrZ3JvdW5kOiAjZjlmOWY5OwogICAgfQoKICAgIC5zdGVwIGgzIHsKICAgICAgICBtYXJnaW4tdG9wOiAwOwogICAgfQoKICAgIC5zdWNjZXNzIHsKICAgICAgICBiYWNrZ3JvdW5kOiAjZThmNWU4OwogICAgICAgIGJvcmRlci1jb2xvcjogIzRjYWY1MDsKICAgIH0KPC9zdHlsZT4KCjxib2R5PgogICAgPGgxPkNpcGhlckxpbmsgLSBSZWNlaXZlIFNlY3JldDwvaDE+CiAgICA8cD5Zb3UndmUgcmVjZWl2ZWQgYW4gZW5jcnlwdGVkIG1lc3NhZ2UuIEZvbGxvdyB0aGUgc3RlcHMgYmVsb3cgdG8gZGVjcnlwdCBpdCBzZWN1cmVseS48L3A+CgogICAgPCEtLSBTdGVwIDE6IEdlbmVyYXRlIGFuZCBzaGFyZSBwdWJsaWMga2V5IC0tPgogICAgPGRpdiBpZD0ic3RlcDEiIGNsYXNzPSJzdGVwIj4KICAgICAgICA8aDM+U3RlcCAxOiBHZW5lcmF0ZSB5b3VyIHB1YmxpYyBrZXk8L2gzPgogICAgICAgIDxwPkNsaWNrIHRoZSBidXR0b24gYmVsb3cgdG8gZ2VuZXJhdGUgeW91ciBwdWJsaWMga2V5LCB0aGVuIHNlbmQgaXQgYmFjayB0byB0aGUgc2VuZGVyLjwvcD4KICAgICAgICA8YnV0dG9uIGlkPSJnZW5lcmF0ZS1rZXlwYWlyIj5HZW5lcmF0ZSBNeSBQdWJsaWMgS2V5PC9idXR0b24+CgogICAgICAgIDxkaXYgaWQ9InB1YmtleS1vdXRwdXQiIGNsYXNzPSJoaWRkZW4iPgogICAgICAgICAgICA8aDQ+U2VuZCB0aGlzIHB1YmxpYyBrZXkgYmFjayB0byB0aGUgc2VuZGVyOjwvaDQ+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjb3B5LXB1YmtleSIgY2xhc3M9ImNvcHktYnRuIj5Db3B5IE15IFB1YmxpYyBLZXk8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9Im15LXB1YmtleSIgY2xhc3M9Im91dCI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFN0ZXAgMjogUmVjZWl2ZSBlbmNyeXB0ZWQga2V5IC0tPgogICAgPGRpdiBpZD0ic3RlcDIiIGNsYXNzPSJzdGVwIGhpZGRlbiI+CiAgICAgICAgPGgzPlN0ZXAgMjogRW50ZXIgdGhlIGVuY3J5cHRlZCBrZXk8L2gzPgogICAgICAgIDxwPlRoZSBzZW5kZXIgd2lsbCBzZW5kIHlvdSBhbiBlbmNyeXB0ZWQga2V5LiBQYXN0ZSBpdCBiZWxvdzo8L3A+CiAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgPGxhYmVsIGZvcj0iZW5jcnlwdGVkLWtleS1pbnB1dCI+RW5jcnlwdGVkIEtleTo8L2xhYmVsPgogICAgICAgICAgICA8aW5wdXQgaWQ9ImVuY3J5cHRlZC1rZXktaW5wdXQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJQYXN0ZSBlbmNyeXB0ZWQga2V5IGhlcmUiIC8+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImRlY3J5cHQtbWVzc2FnZSI+RGVjcnlwdCBNZXNzYWdlPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFN0ZXAgMzogU2hvdyBkZWNyeXB0ZWQgbWVzc2FnZSAtLT4KICAgIDxkaXYgaWQ9InN0ZXAzIiBjbGFzcz0ic3RlcCBoaWRkZW4gc3VjY2VzcyI+CiAgICAgICAgPGgzPlN0ZXAgMzogWW91ciBkZWNyeXB0ZWQgbWVzc2FnZTwvaDM+CiAgICAgICAgPGRpdiBpZD0iZGVjcnlwdGVkLW1lc3NhZ2UiIGNsYXNzPSJvdXQiPjwvZGl2PgogICAgPC9kaXY+CgogICAgPHNjcmlwdCB0eXBlPSJtb2R1bGUtc291cmNlIiBpZD0iYWVzMjU2Z2NtLXNjcmlwdCI+CiAgICAgICAgX19JTkNMVURFX0FFUzI1NkdDTV9KU18yX18KICAgIDwvc2NyaXB0PgoKICAgIDxzY3JpcHQgdHlwZT0ibW9kdWxlLXNvdXJjZSIgaWQ9InBia2RmMi1zY3JpcHQiPgogICAgICAgIF9fSU5DTFVERV9QQktERjJfSlNfMl9fCiAgICA8L3NjcmlwdD4KCiAgICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJ4MjU1MTktc2NyaXB0Ij4KICAgICAgICBfX0lOQ0xVREVfWDI1NTE5X0pTXzJfXwogICAgPC9zY3JpcHQ+CgogICAgPHNjcmlwdCB0eXBlPSJtb2R1bGUiPgogICAgICAgIGNvbnN0ICQgPSAocykgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKTsKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gbG9hZElubGluZU1vZHVsZShpZCkgewogICAgICAgICAgICBjb25zdCBjb2RlID0gJCgnIycgKyBpZCkudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2NvZGVdLCB7IHR5cGU6ICd0ZXh0L2phdmFzY3JpcHQnIH0pKTsKICAgICAgICAgICAgcmV0dXJuIHsgbW9kdWxlOiBhd2FpdCBpbXBvcnQodXJsKSwgY29kZSB9OwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYWVzMjU2Z2NtID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgnYWVzMjU2Z2NtLXNjcmlwdCcpOwogICAgICAgIGNvbnN0IHBia2RmMiA9IGF3YWl0IGxvYWRJbmxpbmVNb2R1bGUoJ3Bia2RmMi1zY3JpcHQnKTsKICAgICAgICBjb25zdCB4MjU1MTkgPSBhd2FpdCBsb2FkSW5saW5lTW9kdWxlKCd4MjU1MTktc2NyaXB0Jyk7CgogICAgICAgIC8vIEVtYmVkZGVkIGRhdGEKICAgICAgICBjb25zdCBDSVBIRVJURVhUX0I2NCA9ICJfX0NJUEhFUlRFWFRfQjY0X18iOwogICAgICAgIGNvbnN0IElWX0I2NCA9ICJfX0lWX0I2NF9fIjsKICAgICAgICBjb25zdCBUQUdfQjY0ID0gIl9fVEFHX0I2NF9fIjsKICAgICAgICBjb25zdCBQVUJBX0I2NCA9ICJfX1BVQkFfQjY0X18iOwoKICAgICAgICAvLyBHbG9iYWwgc3RhdGUKICAgICAgICBsZXQgbXlQcml2YXRlS2V5ID0gbnVsbDsKICAgICAgICBsZXQgbXlQdWJsaWNLZXkgPSBudWxsOwogICAgICAgIGxldCBzaGFyZWRLZXkgPSBudWxsOwoKICAgICAgICAvLyAtLS0gaGVscGVycyAtLS0KICAgICAgICBjb25zdCBlbmMgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgICAgICBjb25zdCBkZWMgPSBuZXcgVGV4dERlY29kZXIoKTsKICAgICAgICBjb25zdCBiNjQgPSAoYnVmKSA9PiBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubmV3IFVpbnQ4QXJyYXkoYnVmKSkpOwogICAgICAgIGNvbnN0IHVuYjY0ID0gKHN0cikgPT4gbmV3IFVpbnQ4QXJyYXkoWy4uLmF0b2Ioc3RyKV0ubWFwKGMgPT4gYy5jaGFyQ29kZUF0KDApKSk7CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNvcHlUb0NsaXBib2FyZCh0ZXh0LCBidXR0b24pIHsKICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gYnV0dG9uLnRleHRDb250ZW50OwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodGV4dCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgICAgICAgICAgICAgdGV4dGFyZWEudmFsdWUgPSB0ZXh0OwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7CiAgICAgICAgICAgICAgICB0ZXh0YXJlYS5zZWxlY3QoKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRhcmVhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAiQ29waWVkISI7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0OwogICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICB9CgogICAgICAgIC8vIEV2ZW50IGxpc3RlbmVycwogICAgICAgICQoIiNnZW5lcmF0ZS1rZXlwYWlyIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBYMjU1MTkga2V5cGFpcgogICAgICAgICAgICAgICAgY29uc3Qga2V5cGFpciA9IHgyNTUxOS5tb2R1bGUuZ2VuZXJhdGVLZXlwYWlyKCk7CiAgICAgICAgICAgICAgICBteVByaXZhdGVLZXkgPSBrZXlwYWlyLnNlY3JldEtleTsKICAgICAgICAgICAgICAgIG15UHVibGljS2V5ID0ga2V5cGFpci5wdWJsaWNLZXk7CgogICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgc2hhcmVkIHNlY3JldCBpbW1lZGlhdGVseSBhbmQgZGVyaXZlIGtleQogICAgICAgICAgICAgICAgY29uc3Qgc2VuZGVyUHViS2V5ID0gdW5iNjQoUFVCQV9CNjQpOwogICAgICAgICAgICAgICAgY29uc3Qgc2hhcmVkU2VjcmV0ID0geDI1NTE5Lm1vZHVsZS5zaGFyZWRLZXkobXlQcml2YXRlS2V5LCBzZW5kZXJQdWJLZXkpOwogICAgICAgICAgICAgICAgc2hhcmVkS2V5ID0gcGJrZGYyLm1vZHVsZS5tYWtlSG1hY1NoYTI1NkZuKHNoYXJlZFNlY3JldCkoZW5jLmVuY29kZSgiQ2lwaGVyTGluay1LZXlEZXJpdmF0aW9uIikpLnNsaWNlKDAsIDMyKTsKCiAgICAgICAgICAgICAgICAvLyBTaG93IHB1YmxpYyBrZXkgdG8gdXNlcgogICAgICAgICAgICAgICAgJCgiI215LXB1YmtleSIpLnRleHRDb250ZW50ID0gYjY0KG15UHVibGljS2V5KTsKICAgICAgICAgICAgICAgICQoIiNwdWJrZXktb3V0cHV0IikuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgICAgICAgICAkKCIjc3RlcDIiKS5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgICAgICAgICQoIiNnZW5lcmF0ZS1rZXlwYWlyIikuZGlzYWJsZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8vIENsZWFuIHVwIHNoYXJlZCBzZWNyZXQgKGtlZXAgc2hhcmVkS2V5IGZvciBsYXRlcikKICAgICAgICAgICAgICAgIHNoYXJlZFNlY3JldC5maWxsKDApOwogICAgICAgICAgICAgICAgbXlQcml2YXRlS2V5LmZpbGwoMCk7CgogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KGBFcnJvcjogJHtlcnIubWVzc2FnZX1gKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAkKCIjY29weS1wdWJrZXkiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcHVia2V5ID0gJCgiI215LXB1YmtleSIpLnRleHRDb250ZW50OwogICAgICAgICAgICBpZiAocHVia2V5KSBjb3B5VG9DbGlwYm9hcmQocHVia2V5LCAkKCIjY29weS1wdWJrZXkiKSk7CiAgICAgICAgfSk7CgogICAgICAgICQoIiNkZWNyeXB0LW1lc3NhZ2UiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgZW5jcnlwdGVkS2V5SW5wdXQgPSAkKCIjZW5jcnlwdGVkLWtleS1pbnB1dCIpLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFlbmNyeXB0ZWRLZXlJbnB1dCkgewogICAgICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBlbnRlciB0aGUgZW5jcnlwdGVkIGtleS4iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFBhcnNlIGVuY3J5cHRlZCBrZXkgZGF0YQogICAgICAgICAgICAgICAgY29uc3QgZW5jcnlwdGVkS2V5RGF0YSA9IEpTT04ucGFyc2UoZW5jcnlwdGVkS2V5SW5wdXQpOwogICAgICAgICAgICAgICAgY29uc3QgeyBjdCwgaXYsIHRhZyB9ID0gZW5jcnlwdGVkS2V5RGF0YTsKCiAgICAgICAgICAgICAgICAvLyBEZWNyeXB0IHRoZSBtZXNzYWdlIGtleQogICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUtleSA9IGFlczI1NmdjbS5tb2R1bGUuYWVzMjU2R2NtRGVjcnlwdCh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBzaGFyZWRLZXksCiAgICAgICAgICAgICAgICAgICAgaXY6IHVuYjY0KGl2KSwKICAgICAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0OiB1bmI2NChjdCksCiAgICAgICAgICAgICAgICAgICAgdGFnOiB1bmI2NCh0YWcpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBEZWNyeXB0IHRoZSBhY3R1YWwgbWVzc2FnZQogICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFlczI1NmdjbS5tb2R1bGUuYWVzMjU2R2NtRGVjcnlwdCh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBtZXNzYWdlS2V5LAogICAgICAgICAgICAgICAgICAgIGl2OiB1bmI2NChJVl9CNjQpLAogICAgICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IHVuYjY0KENJUEhFUlRFWFRfQjY0KSwKICAgICAgICAgICAgICAgICAgICB0YWc6IHVuYjY0KFRBR19CNjQpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBTaG93IGRlY3J5cHRlZCBtZXNzYWdlCiAgICAgICAgICAgICAgICAkKCIjZGVjcnlwdGVkLW1lc3NhZ2UiKS50ZXh0Q29udGVudCA9IGRlYy5kZWNvZGUobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAkKCIjc3RlcDMiKS5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKCiAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCBzZW5zaXRpdmUgZGF0YQogICAgICAgICAgICAgICAgbWVzc2FnZUtleS5maWxsKDApOwogICAgICAgICAgICAgICAgc2hhcmVkS2V5LmZpbGwoMCk7CiAgICAgICAgICAgICAgICBteVByaXZhdGVLZXkuZmlsbCgwKTsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgYWxlcnQoYEVycm9yIGRlY3J5cHRpbmcgbWVzc2FnZTogJHtlcnIubWVzc2FnZX1gKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgIDwvc2NyaXB0Pgo8L2JvZHk+Cgo8L2h0bWw+CiAgPC90ZW1wbGF0ZT4KCiAgPHNjcmlwdCB0eXBlPSJtb2R1bGUtc291cmNlIiBpZD0iYWVzMjU2Z2NtLXNjcmlwdCI+CiAgICAKCmNvbnN0IFIgPSAweGUxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwbjsgCgpmdW5jdGlvbiB0b1U4KHYpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgPyB2IDogbmV3IFVpbnQ4QXJyYXkodik7Cn0KZnVuY3Rpb24geG9yQnl0ZXMoYSwgYikgewogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGEubGVuZ3RoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIG91dFtpXSA9IGFbaV0gXiBiW2ldOwogIHJldHVybiBvdXQ7Cn0KZnVuY3Rpb24gemVybyhuKSB7CiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KG4pOwp9CgpmdW5jdGlvbiBieXRlc1RvQmlnSW50QkUoYikgewogIGxldCB4ID0gMG47CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB4ID0gKHggPDwgOG4pIHwgQmlnSW50KGJbaV0pOwogIHJldHVybiB4Owp9CmZ1bmN0aW9uIGJpZ0ludFRvQnl0ZXNCRSh4LCBsZW4pIHsKICBjb25zdCBvdXQgPSBuZXcgVWludDhBcnJheShsZW4pOwogIGZvciAobGV0IGkgPSBsZW4gLSAxOyBpID49IDA7IGktLSkgewogICAgb3V0W2ldID0gTnVtYmVyKHggJiAweGZmbik7CiAgICB4ID4+PSA4bjsKICB9CiAgcmV0dXJuIG91dDsKfQoKY29uc3QgYjY0VG9VOCA9IChiNjQpID0+IFVpbnQ4QXJyYXkuZnJvbShhdG9iKGI2NCksIChjKSA9PiBjLmNoYXJDb2RlQXQoMCkpOwoKY29uc3QgUyA9IGI2NFRvVTgoCiAgIlkzeDNlL0pyYjhVd0FXY3IvdGVyZHNxQ3lYMzZXVWZ3cmRTaXI1eWtjc0MzL1pNbU5qLzN6RFNsNWZGeDJERVZCTWNqd3hpV0Jab0hFb0RpNnlleWRRbURMQm9iYmxxZ1VqdldzeW5qTDRSVDBRRHRJUHl4VzJyTHZqbEtURmpQME8rcSswTk5NNFZGK1FKL1VEeWZxRkdqUUkrU25UajF2TGJhSVJELzg5TE5EQlBzWDVkRUY4U25majFrWFJsellJRlAzQ0lxa0loRzdyZ1UzbDRMMitBeU9ncEpCaVJjd3RPc1lwR1Y1SG5ueURkdGpkVk9xV3hXOU9wbGVxNEl1bmdsTGh5bXRNYm8zWFFmUzcyTGluQSt0V1pJQS9ZT1lUVlh1WWJCSFo3aCtKZ1JhZG1PbEpzZWgrbk9WU2pmaktHSkRiL21RbWhCbVMwUHNGUzdGZz09IgopOwpjb25zdCBSY29uID0gYjY0VG9VOCgiQUFFQ0JBZ1FJRUNBR3paczJLdE5tZz09Iik7CgpmdW5jdGlvbiByb3RXb3JkKHcpIHsKICByZXR1cm4gW3dbMV0sIHdbMl0sIHdbM10sIHdbMF1dOwp9CmZ1bmN0aW9uIHN1YldvcmQodykgewogIHJldHVybiB3Lm1hcCgoeCkgPT4gU1t4XSk7Cn0KCmZ1bmN0aW9uIGtleUV4cGFuZDI1NihrZXkpIHsKICBrZXkgPSB0b1U4KGtleSk7CiAgaWYgKGtleS5sZW5ndGggIT09IDMyKSB0aHJvdyBuZXcgRXJyb3IoIkFFUy0yNTYga2V5IG11c3QgYmUgMzIgYnl0ZXMiKTsKCiAgY29uc3QgTmsgPSA4LAogICAgTmIgPSA0LAogICAgTnIgPSAxNDsKICBjb25zdCB3ID0gbmV3IFVpbnQ4QXJyYXkoTmIgKiAoTnIgKyAxKSAqIDQpOwogIHcuc2V0KGtleSk7CiAgY29uc3QgdGVtcCA9IFswLCAwLCAwLCAwXTsKICBsZXQgYnl0ZXNHZW5lcmF0ZWQgPSAzMjsKICBsZXQgcmNvbkl0ZXIgPSAxOwoKICB3aGlsZSAoYnl0ZXNHZW5lcmF0ZWQgPCB3Lmxlbmd0aCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHRlbXBbaV0gPSB3W2J5dGVzR2VuZXJhdGVkIC0gNCArIGldOwogICAgaWYgKChieXRlc0dlbmVyYXRlZCAvIDQpICUgTmsgPT09IDApIHsKICAgICAgbGV0IHQgPSByb3RXb3JkKHRlbXApOwogICAgICB0ID0gc3ViV29yZCh0KTsKICAgICAgdFswXSBePSBSY29uW3Jjb25JdGVyKytdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgdGVtcFtpXSA9IHRbaV07CiAgICB9IGVsc2UgaWYgKChieXRlc0dlbmVyYXRlZCAvIDQpICUgTmsgPT09IDQpIHsKICAgICAgbGV0IHQgPSBzdWJXb3JkKHRlbXApOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgdGVtcFtpXSA9IHRbaV07CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICB3W2J5dGVzR2VuZXJhdGVkXSA9IHdbYnl0ZXNHZW5lcmF0ZWQgLSAzMl0gXiB0ZW1wW2ldOwogICAgICBieXRlc0dlbmVyYXRlZCsrOwogICAgfQogIH0KICByZXR1cm4gdzsgCn0KCmZ1bmN0aW9uIGFkZFJvdW5kS2V5KHMsIHJrLCByb3VuZCkgewogIGZvciAobGV0IGMgPSAwOyBjIDwgNDsgYysrKSB7CiAgICBzWzAgKyA0ICogY10gXj0gcmtbcm91bmQgKiAxNiArIDQgKiBjICsgMF07CiAgICBzWzEgKyA0ICogY10gXj0gcmtbcm91bmQgKiAxNiArIDQgKiBjICsgMV07CiAgICBzWzIgKyA0ICogY10gXj0gcmtbcm91bmQgKiAxNiArIDQgKiBjICsgMl07CiAgICBzWzMgKyA0ICogY10gXj0gcmtbcm91bmQgKiAxNiArIDQgKiBjICsgM107CiAgfQp9CmZ1bmN0aW9uIHN1YkJ5dGVzKHMpIHsKICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHNbaV0gPSBTW3NbaV1dOwp9CmZ1bmN0aW9uIHNoaWZ0Um93cyhzKSB7CiAgY29uc3QgdCA9IHMuc2xpY2UoKTsKICBzWzFdID0gdFs1XTsKICBzWzVdID0gdFs5XTsKICBzWzldID0gdFsxM107CiAgc1sxM10gPSB0WzFdOwogIHNbMl0gPSB0WzEwXTsKICBzWzZdID0gdFsxNF07CiAgc1sxMF0gPSB0WzJdOwogIHNbMTRdID0gdFs2XTsKICBzWzNdID0gdFsxNV07CiAgc1s3XSA9IHRbM107CiAgc1sxMV0gPSB0WzddOwogIHNbMTVdID0gdFsxMV07Cn0KZnVuY3Rpb24geHRpbWUoeCkgewogIHJldHVybiAoKHggPDwgMSkgXiAoeCAmIDB4ODAgPyAweDFiIDogMCkpICYgMHhmZjsKfQpmdW5jdGlvbiBtaXhDb2x1bW5zKHMpIHsKICBmb3IgKGxldCBjID0gMDsgYyA8IDQ7IGMrKykgewogICAgY29uc3QgaSA9IDQgKiBjOwogICAgY29uc3QgYTAgPSBzW2ldLAogICAgICBhMSA9IHNbaSArIDFdLAogICAgICBhMiA9IHNbaSArIDJdLAogICAgICBhMyA9IHNbaSArIDNdOwogICAgY29uc3QgcjAgPSB4dGltZShhMCkgXiAoYTEgXiB4dGltZShhMSkpIF4gYTIgXiBhMzsKICAgIGNvbnN0IHIxID0gYTAgXiB4dGltZShhMSkgXiAoYTIgXiB4dGltZShhMikpIF4gYTM7CiAgICBjb25zdCByMiA9IGEwIF4gYTEgXiB4dGltZShhMikgXiAoYTMgXiB4dGltZShhMykpOwogICAgY29uc3QgcjMgPSBhMCBeIHh0aW1lKGEwKSBeIGExIF4gYTIgXiB4dGltZShhMyk7CiAgICBzW2ldID0gcjAgJiAweGZmOwogICAgc1tpICsgMV0gPSByMSAmIDB4ZmY7CiAgICBzW2kgKyAyXSA9IHIyICYgMHhmZjsKICAgIHNbaSArIDNdID0gcjMgJiAweGZmOwogIH0KfQpmdW5jdGlvbiBhZXNFbmNyeXB0QmxvY2socmssIGJsb2NrMTYpIHsKICBjb25zdCBOciA9IDE0OwogIGNvbnN0IHMgPSBuZXcgVWludDhBcnJheShibG9jazE2KTsKICBhZGRSb3VuZEtleShzLCByaywgMCk7CiAgZm9yIChsZXQgcm91bmQgPSAxOyByb3VuZCA8IE5yOyByb3VuZCsrKSB7CiAgICBzdWJCeXRlcyhzKTsKICAgIHNoaWZ0Um93cyhzKTsKICAgIG1peENvbHVtbnMocyk7CiAgICBhZGRSb3VuZEtleShzLCByaywgcm91bmQpOwogIH0KICBzdWJCeXRlcyhzKTsKICBzaGlmdFJvd3Mocyk7CiAgYWRkUm91bmRLZXkocywgcmssIE5yKTsKICByZXR1cm4gczsKfQoKZnVuY3Rpb24gaW5jMzIoY291bnRlcjE2KSB7CiAgY29uc3Qgb3V0ID0gY291bnRlcjE2LnNsaWNlKCk7CiAgCiAgbGV0IGNhcnJ5ID0gMTsKICBmb3IgKGxldCBpID0gMTU7IGkgPj0gMTI7IGktLSkgewogICAgY29uc3QgdiA9IChvdXRbaV0gfCAwKSArIGNhcnJ5OwogICAgb3V0W2ldID0gdiAmIDB4ZmY7CiAgICBjYXJyeSA9IHYgPj4+IDg7CiAgICBpZiAoIWNhcnJ5KSBicmVhazsKICB9CiAgcmV0dXJuIG91dDsKfQoKZnVuY3Rpb24gZ2hhc2hNdWx0aXBseSh4MTI4LCB5MTI4KSB7CiAgbGV0IFogPSAwbjsKICBsZXQgViA9IHkxMjg7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjg7IGkrKykgewogICAgY29uc3QgYml0ID0gKHgxMjggPj4gQmlnSW50KDEyNyAtIGkpKSAmIDFuOwogICAgaWYgKGJpdCkgWiBePSBWOwogICAgaWYgKChWICYgMW4pID09PSAwbikgewogICAgICBWID4+PSAxbjsKICAgIH0gZWxzZSB7CiAgICAgIFYgPSAoViA+PiAxbikgXiBSOwogICAgfQogIH0KICByZXR1cm4gWjsKfQoKZnVuY3Rpb24gZ2hhc2goSCwgQSwgQykgewogIAogIGZ1bmN0aW9uIHBhZDE2KHU4KSB7CiAgICBjb25zdCByZW0gPSB1OC5sZW5ndGggJSAxNjsKICAgIHJldHVybiByZW0gPyBuZXcgVWludDhBcnJheShbLi4udTgsIC4uLm5ldyBVaW50OEFycmF5KDE2IC0gcmVtKV0pIDogdTg7CiAgfQogIGNvbnN0IEFfID0gcGFkMTYoQSk7CiAgY29uc3QgQ18gPSBwYWQxNihDKTsKCiAgbGV0IFkgPSAwbjsKICBjb25zdCBIbiA9IGJ5dGVzVG9CaWdJbnRCRShIKTsKCiAgZm9yIChsZXQgb2ZmID0gMDsgb2ZmIDwgQV8ubGVuZ3RoOyBvZmYgKz0gMTYpIHsKICAgIGNvbnN0IFhpID0gYnl0ZXNUb0JpZ0ludEJFKEFfLnN1YmFycmF5KG9mZiwgb2ZmICsgMTYpKTsKICAgIFkgPSBnaGFzaE11bHRpcGx5KFkgXiBYaSwgSG4pOwogIH0KICBmb3IgKGxldCBvZmYgPSAwOyBvZmYgPCBDXy5sZW5ndGg7IG9mZiArPSAxNikgewogICAgY29uc3QgWGkgPSBieXRlc1RvQmlnSW50QkUoQ18uc3ViYXJyYXkob2ZmLCBvZmYgKyAxNikpOwogICAgWSA9IGdoYXNoTXVsdGlwbHkoWSBeIFhpLCBIbik7CiAgfQoKICBjb25zdCBsZW5CbG9jayA9IG5ldyBVaW50OEFycmF5KDE2KTsKICBjb25zdCBhQml0cyA9IEJpZ0ludChBLmxlbmd0aCkgKiA4bjsKICBjb25zdCBjQml0cyA9IEJpZ0ludChDLmxlbmd0aCkgKiA4bjsKICBsZW5CbG9jay5zZXQoYmlnSW50VG9CeXRlc0JFKGFCaXRzLCA4KSwgMCk7CiAgbGVuQmxvY2suc2V0KGJpZ0ludFRvQnl0ZXNCRShjQml0cywgOCksIDgpOwoKICBZID0gZ2hhc2hNdWx0aXBseShZIF4gYnl0ZXNUb0JpZ0ludEJFKGxlbkJsb2NrKSwgSG4pOwogIHJldHVybiBiaWdJbnRUb0J5dGVzQkUoWSwgMTYpOwp9CgpmdW5jdGlvbiBnY3RyKHJrLCBpY2IsIGlucHV0KSB7CiAgCiAgaWYgKGlucHV0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGlucHV0Lmxlbmd0aCk7CiAgbGV0IGN0ciA9IGljYi5zbGljZSgpOwogIGZvciAobGV0IG9mZiA9IDA7IG9mZiA8IGlucHV0Lmxlbmd0aDsgb2ZmICs9IDE2KSB7CiAgICBjdHIgPSBpbmMzMihjdHIpOwogICAgY29uc3Qga2V5c3RyZWFtID0gYWVzRW5jcnlwdEJsb2NrKHJrLCBjdHIpOwogICAgY29uc3QgY2h1bmsgPSBpbnB1dC5zdWJhcnJheShvZmYsIE1hdGgubWluKG9mZiArIDE2LCBpbnB1dC5sZW5ndGgpKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmsubGVuZ3RoOyBpKyspIHsKICAgICAgb3V0W29mZiArIGldID0gY2h1bmtbaV0gXiBrZXlzdHJlYW1baV07CiAgICB9CiAgfQogIHJldHVybiBvdXQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBhZXMyNTZHY21FbmNyeXB0KHsKICBrZXksCiAgaXYsCiAgcGxhaW50ZXh0LAogIGFhZCA9IG5ldyBVaW50OEFycmF5KDApLAogIHRhZ0xlbmd0aCA9IDE2LAp9KSB7CiAga2V5ID0gdG9VOChrZXkpOwogIGl2ID0gdG9VOChpdik7CiAgcGxhaW50ZXh0ID0gdG9VOChwbGFpbnRleHQpOwogIGFhZCA9IHRvVTgoYWFkKTsKICBpZiAoa2V5Lmxlbmd0aCAhPT0gMzIpIHRocm93IG5ldyBFcnJvcigiQUVTLTI1NiBrZXkgbXVzdCBiZSAzMiBieXRlcyIpOwogIGlmICh0YWdMZW5ndGggIT09IDE2KQogICAgdGhyb3cgbmV3IEVycm9yKCJPbmx5IDEyOC1iaXQgdGFncyBzdXBwb3J0ZWQgaW4gdGhpcyByZWZlcmVuY2UiKTsKCiAgY29uc3QgcmsgPSBrZXlFeHBhbmQyNTYoa2V5KTsKICBjb25zdCBIID0gYWVzRW5jcnlwdEJsb2NrKHJrLCB6ZXJvKDE2KSk7IAoKICBsZXQgSjA7CiAgaWYgKGl2Lmxlbmd0aCA9PT0gMTIpIHsKICAgIEowID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgSjAuc2V0KGl2LCAwKTsKICAgIEowWzE1XSA9IDE7IAogIH0gZWxzZSB7CiAgICBjb25zdCBTID0gZ2hhc2goSCwgbmV3IFVpbnQ4QXJyYXkoMCksIGl2KTsKICAgIEowID0gUzsgCiAgfQoKICBjb25zdCBjaXBoZXJ0ZXh0ID0gZ2N0cihyaywgSjAsIHBsYWludGV4dCk7IAogIGNvbnN0IFMgPSBnaGFzaChILCBhYWQsIGNpcGhlcnRleHQpOwogIGNvbnN0IHRhZyA9IHhvckJ5dGVzKGFlc0VuY3J5cHRCbG9jayhyaywgSjApLCBTKS5zdWJhcnJheSgwLCB0YWdMZW5ndGgpOwoKICByZXR1cm4geyBjaXBoZXJ0ZXh0LCB0YWcgfTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGFlczI1NkdjbURlY3J5cHQoewogIGtleSwKICBpdiwKICBjaXBoZXJ0ZXh0LAogIGFhZCA9IG5ldyBVaW50OEFycmF5KDApLAogIHRhZywKfSkgewogIGtleSA9IHRvVTgoa2V5KTsKICBpdiA9IHRvVTgoaXYpOwogIGNpcGhlcnRleHQgPSB0b1U4KGNpcGhlcnRleHQpOwogIGFhZCA9IHRvVTgoYWFkKTsKICB0YWcgPSB0b1U4KHRhZyk7CiAgaWYgKGtleS5sZW5ndGggIT09IDMyKSB0aHJvdyBuZXcgRXJyb3IoIkFFUy0yNTYga2V5IG11c3QgYmUgMzIgYnl0ZXMiKTsKICBpZiAodGFnLmxlbmd0aCAhPT0gMTYpCiAgICB0aHJvdyBuZXcgRXJyb3IoIk9ubHkgMTI4LWJpdCB0YWdzIHN1cHBvcnRlZCBpbiB0aGlzIHJlZmVyZW5jZSIpOwoKICBjb25zdCByayA9IGtleUV4cGFuZDI1NihrZXkpOwogIGNvbnN0IEggPSBhZXNFbmNyeXB0QmxvY2socmssIHplcm8oMTYpKTsKCiAgbGV0IEowOwogIGlmIChpdi5sZW5ndGggPT09IDEyKSB7CiAgICBKMCA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIEowLnNldChpdiwgMCk7CiAgICBKMFsxNV0gPSAxOwogIH0gZWxzZSB7CiAgICBKMCA9IGdoYXNoKEgsIG5ldyBVaW50OEFycmF5KDApLCBpdik7CiAgfQoKICBjb25zdCBTID0gZ2hhc2goSCwgYWFkLCBjaXBoZXJ0ZXh0KTsKICBjb25zdCBleHBlY3RlZFRhZyA9IHhvckJ5dGVzKGFlc0VuY3J5cHRCbG9jayhyaywgSjApLCBTKS5zdWJhcnJheSgKICAgIDAsCiAgICB0YWcubGVuZ3RoCiAgKTsKCiAgaWYgKGV4cGVjdGVkVGFnLmxlbmd0aCAhPT0gdGFnLmxlbmd0aCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBwbGFpbnRleHQ6IG51bGwgfTsKICBsZXQgZGlmZiA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWcubGVuZ3RoOyBpKyspIGRpZmYgfD0gZXhwZWN0ZWRUYWdbaV0gXiB0YWdbaV07CiAgaWYgKGRpZmYgIT09IDApIHJldHVybiB7IG9rOiBmYWxzZSwgcGxhaW50ZXh0OiBudWxsIH07CgogIGNvbnN0IHBsYWludGV4dCA9IGdjdHIocmssIEowLCBjaXBoZXJ0ZXh0KTsKICByZXR1cm4geyBvazogdHJ1ZSwgcGxhaW50ZXh0IH07Cn0KCiAgPC9zY3JpcHQ+CgogIDxzY3JpcHQgdHlwZT0ibW9kdWxlLXNvdXJjZSIgaWQ9InBia2RmMi1zY3JpcHQiPgogICAgCgpjb25zdCB0b1U4ID0gKHYpID0+ICh2IGluc3RhbmNlb2YgVWludDhBcnJheSA/IHYgOiBuZXcgVWludDhBcnJheSh2KSk7CmNvbnN0IGNvbmNhdCA9IChhLCBiKSA9PiB7CiAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoYS5sZW5ndGggKyBiLmxlbmd0aCk7CiAgb3V0LnNldChhLCAwKTsKICBvdXQuc2V0KGIsIGEubGVuZ3RoKTsKICByZXR1cm4gb3V0Owp9Owpjb25zdCBpMzJiZSA9ICh4KSA9PgogIG5ldyBVaW50OEFycmF5KFsKICAgICh4ID4+PiAyNCkgJiAweGZmLAogICAgKHggPj4+IDE2KSAmIDB4ZmYsCiAgICAoeCA+Pj4gOCkgJiAweGZmLAogICAgeCAmIDB4ZmYsCiAgXSk7Cgpjb25zdCBLID0gbmV3IFVpbnQzMkFycmF5KFsKICAweDQyOGEyZjk4LCAweDcxMzc0NDkxLCAweGI1YzBmYmNmLCAweGU5YjVkYmE1LCAweDM5NTZjMjViLCAweDU5ZjExMWYxLAogIDB4OTIzZjgyYTQsIDB4YWIxYzVlZDUsIDB4ZDgwN2FhOTgsIDB4MTI4MzViMDEsIDB4MjQzMTg1YmUsIDB4NTUwYzdkYzMsCiAgMHg3MmJlNWQ3NCwgMHg4MGRlYjFmZSwgMHg5YmRjMDZhNywgMHhjMTliZjE3NCwgMHhlNDliNjljMSwgMHhlZmJlNDc4NiwKICAweDBmYzE5ZGM2LCAweDI0MGNhMWNjLCAweDJkZTkyYzZmLCAweDRhNzQ4NGFhLCAweDVjYjBhOWRjLCAweDc2Zjk4OGRhLAogIDB4OTgzZTUxNTIsIDB4YTgzMWM2NmQsIDB4YjAwMzI3YzgsIDB4YmY1OTdmYzcsIDB4YzZlMDBiZjMsIDB4ZDVhNzkxNDcsCiAgMHgwNmNhNjM1MSwgMHgxNDI5Mjk2NywgMHgyN2I3MGE4NSwgMHgyZTFiMjEzOCwgMHg0ZDJjNmRmYywgMHg1MzM4MGQxMywKICAweDY1MGE3MzU0LCAweDc2NmEwYWJiLCAweDgxYzJjOTJlLCAweDkyNzIyYzg1LCAweGEyYmZlOGExLCAweGE4MWE2NjRiLAogIDB4YzI0YjhiNzAsIDB4Yzc2YzUxYTMsIDB4ZDE5MmU4MTksIDB4ZDY5OTA2MjQsIDB4ZjQwZTM1ODUsIDB4MTA2YWEwNzAsCiAgMHgxOWE0YzExNiwgMHgxZTM3NmMwOCwgMHgyNzQ4Nzc0YywgMHgzNGIwYmNiNSwgMHgzOTFjMGNiMywgMHg0ZWQ4YWE0YSwKICAweDViOWNjYTRmLCAweDY4MmU2ZmYzLCAweDc0OGY4MmVlLCAweDc4YTU2MzZmLCAweDg0Yzg3ODE0LCAweDhjYzcwMjA4LAogIDB4OTBiZWZmZmEsIDB4YTQ1MDZjZWIsIDB4YmVmOWEzZjcsIDB4YzY3MTc4ZjIsCl0pOwpjb25zdCBST1RSID0gKHgsIG4pID0+ICh4ID4+PiBuKSB8ICh4IDw8ICgzMiAtIG4pKTsKY29uc3QgQ2ggPSAoeCwgeSwgeikgPT4gKHggJiB5KSBeICh+eCAmIHopOwpjb25zdCBNYWogPSAoeCwgeSwgeikgPT4gKHggJiB5KSBeICh4ICYgeikgXiAoeSAmIHopOwpjb25zdCBTaWdtYTAgPSAoeCkgPT4gUk9UUih4LCAyKSBeIFJPVFIoeCwgMTMpIF4gUk9UUih4LCAyMik7CmNvbnN0IFNpZ21hMSA9ICh4KSA9PiBST1RSKHgsIDYpIF4gUk9UUih4LCAxMSkgXiBST1RSKHgsIDI1KTsKY29uc3Qgc2lnbWEwID0gKHgpID0+IFJPVFIoeCwgNykgXiBST1RSKHgsIDE4KSBeICh4ID4+PiAzKTsKY29uc3Qgc2lnbWExID0gKHgpID0+IFJPVFIoeCwgMTcpIF4gUk9UUih4LCAxOSkgXiAoeCA+Pj4gMTApOwoKZXhwb3J0IGZ1bmN0aW9uIHNoYTI1Nihtc2dVOCkgewogIGNvbnN0IG0gPSB0b1U4KG1zZ1U4KTsKICAKICBsZXQgaDAgPSAweDZhMDllNjY3LAogICAgaDEgPSAweGJiNjdhZTg1LAogICAgaDIgPSAweDNjNmVmMzcyLAogICAgaDMgPSAweGE1NGZmNTNhOwogIGxldCBoNCA9IDB4NTEwZTUyN2YsCiAgICBoNSA9IDB4OWIwNTY4OGMsCiAgICBoNiA9IDB4MWY4M2Q5YWIsCiAgICBoNyA9IDB4NWJlMGNkMTk7CgogIGNvbnN0IGJpdExlbkhpID0gTWF0aC5mbG9vcigobS5sZW5ndGggLyAweDIwMDAwMDAwKSA+Pj4gMCk7IAogIGNvbnN0IGJpdExlbkxvID0gKChtLmxlbmd0aCA+Pj4gMCkgKiA4KSA+Pj4gMDsgCiAgY29uc3QgayA9IC0obS5sZW5ndGggKyA5KSAmIDYzOwogIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KG0ubGVuZ3RoICsgMSArIGsgKyA4KTsKICBwYWRkZWQuc2V0KG0sIDApOwogIHBhZGRlZFttLmxlbmd0aF0gPSAweDgwOwogIAogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gOF0gPSAoYml0TGVuSGkgPj4+IDI0KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSA3XSA9IChiaXRMZW5IaSA+Pj4gMTYpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDZdID0gKGJpdExlbkhpID4+PiA4KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSA1XSA9IGJpdExlbkhpICYgMHhmZjsKICBwYWRkZWRbcGFkZGVkLmxlbmd0aCAtIDRdID0gKGJpdExlbkxvID4+PiAyNCkgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gM10gPSAoYml0TGVuTG8gPj4+IDE2KSAmIDB4ZmY7CiAgcGFkZGVkW3BhZGRlZC5sZW5ndGggLSAyXSA9IChiaXRMZW5MbyA+Pj4gOCkgJiAweGZmOwogIHBhZGRlZFtwYWRkZWQubGVuZ3RoIC0gMV0gPSBiaXRMZW5MbyAmIDB4ZmY7CgogIGNvbnN0IFcgPSBuZXcgVWludDMyQXJyYXkoNjQpOwoKICBmb3IgKGxldCBvZmYgPSAwOyBvZmYgPCBwYWRkZWQubGVuZ3RoOyBvZmYgKz0gNjQpIHsKICAgIAogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAgICAgIGNvbnN0IGogPSBvZmYgKyAoaSA8PCAyKTsKICAgICAgV1tpXSA9CiAgICAgICAgKHBhZGRlZFtqXSA8PCAyNCkgfAogICAgICAgIChwYWRkZWRbaiArIDFdIDw8IDE2KSB8CiAgICAgICAgKHBhZGRlZFtqICsgMl0gPDwgOCkgfAogICAgICAgIHBhZGRlZFtqICsgM107CiAgICB9CiAgICBmb3IgKGxldCBpID0gMTY7IGkgPCA2NDsgaSsrKSB7CiAgICAgIFdbaV0gPQogICAgICAgIChzaWdtYTEoV1tpIC0gMl0pICsgV1tpIC0gN10gKyBzaWdtYTAoV1tpIC0gMTVdKSArIFdbaSAtIDE2XSkgPj4+IDA7CiAgICB9CgogICAgbGV0IGEgPSBoMCwKICAgICAgYiA9IGgxLAogICAgICBjID0gaDIsCiAgICAgIGQgPSBoMywKICAgICAgZSA9IGg0LAogICAgICBmID0gaDUsCiAgICAgIGcgPSBoNiwKICAgICAgaCA9IGg3OwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjQ7IGkrKykgewogICAgICBjb25zdCB0MSA9IChoICsgU2lnbWExKGUpICsgQ2goZSwgZiwgZykgKyBLW2ldICsgV1tpXSkgPj4+IDA7CiAgICAgIGNvbnN0IHQyID0gKFNpZ21hMChhKSArIE1haihhLCBiLCBjKSkgPj4+IDA7CiAgICAgIGggPSBnOwogICAgICBnID0gZjsKICAgICAgZiA9IGU7CiAgICAgIGUgPSAoZCArIHQxKSA+Pj4gMDsKICAgICAgZCA9IGM7CiAgICAgIGMgPSBiOwogICAgICBiID0gYTsKICAgICAgYSA9ICh0MSArIHQyKSA+Pj4gMDsKICAgIH0KCiAgICBoMCA9IChoMCArIGEpID4+PiAwOwogICAgaDEgPSAoaDEgKyBiKSA+Pj4gMDsKICAgIGgyID0gKGgyICsgYykgPj4+IDA7CiAgICBoMyA9IChoMyArIGQpID4+PiAwOwogICAgaDQgPSAoaDQgKyBlKSA+Pj4gMDsKICAgIGg1ID0gKGg1ICsgZikgPj4+IDA7CiAgICBoNiA9IChoNiArIGcpID4+PiAwOwogICAgaDcgPSAoaDcgKyBoKSA+Pj4gMDsKICB9CgogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KDMyKTsKICBjb25zdCBIID0gW2gwLCBoMSwgaDIsIGgzLCBoNCwgaDUsIGg2LCBoN107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIG91dC5zZXQoaTMyYmUoSFtpXSksIGkgKiA0KTsKICByZXR1cm4gb3V0Owp9CgpmdW5jdGlvbiBtYWtlSG1hY1NoYTI1NihrZXkpIHsKICBrZXkgPSB0b1U4KGtleSk7CiAgY29uc3QgYmxvY2sgPSA2NDsKICBpZiAoa2V5Lmxlbmd0aCA+IGJsb2NrKSBrZXkgPSBzaGEyNTYoa2V5KTsKICBpZiAoa2V5Lmxlbmd0aCA8IGJsb2NrKSB7CiAgICBjb25zdCBrID0gbmV3IFVpbnQ4QXJyYXkoYmxvY2spOwogICAgay5zZXQoa2V5KTsKICAgIGtleSA9IGs7CiAgfQogIGNvbnN0IGlwYWQgPSBuZXcgVWludDhBcnJheShibG9jayk7CiAgY29uc3Qgb3BhZCA9IG5ldyBVaW50OEFycmF5KGJsb2NrKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrOyBpKyspIHsKICAgIGlwYWRbaV0gPSBrZXlbaV0gXiAweDM2OwogICAgb3BhZFtpXSA9IGtleVtpXSBeIDB4NWM7CiAgfQogIHJldHVybiAobXNnKSA9PiBzaGEyNTYoY29uY2F0KG9wYWQsIHNoYTI1Nihjb25jYXQoaXBhZCwgdG9VOChtc2cpKSkpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIG1ha2VIbWFjU2hhMjU2Rm4oa2V5KSB7CiAgaWYgKGtleSA9PSBudWxsIHx8IGtleS5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcigiSE1BQyBrZXkgbXVzdCBiZSBub24tZW1wdHkiKTsKICBjb25zdCBobWFjID0gbWFrZUhtYWNTaGEyNTYoa2V5KTsKICByZXR1cm4gKG1zZykgPT4gaG1hYyhtc2cpOwp9CgpleHBvcnQgZnVuY3Rpb24gcGJrZGYyU2hhMjU2KHsgcGFzc3dvcmQsIHNhbHQsIGl0ZXJhdGlvbnMsIGRrTGVuIH0pIHsKICBjb25zdCBQID0gdG9VOChwYXNzd29yZCk7CiAgY29uc3QgUyA9IHRvVTgoc2FsdCk7CiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGl0ZXJhdGlvbnMpIHx8IGl0ZXJhdGlvbnMgPD0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJpdGVyYXRpb25zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7CiAgfQogIGlmICghTnVtYmVyLmlzSW50ZWdlcihka0xlbikgfHwgZGtMZW4gPD0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJka0xlbiBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpOwogIH0KCiAgY29uc3QgaExlbiA9IDMyOyAKICBjb25zdCBsID0gTWF0aC5jZWlsKGRrTGVuIC8gaExlbik7CiAgY29uc3QgciA9IGRrTGVuIC0gKGwgLSAxKSAqIGhMZW47CgogIGNvbnN0IFBSRiA9IG1ha2VIbWFjU2hhMjU2KFApOwogIGNvbnN0IERLID0gbmV3IFVpbnQ4QXJyYXkoZGtMZW4pOwogIGNvbnN0IGJsb2NrQnVmID0gbmV3IFVpbnQ4QXJyYXkoaExlbik7IAoKICBmb3IgKGxldCBpID0gMTsgaSA8PSBsOyBpKyspIHsKICAgIAogICAgY29uc3QgVTEgPSBQUkYoY29uY2F0KFMsIGkzMmJlKGkpKSk7CiAgICBibG9ja0J1Zi5zZXQoVTEpOwogICAgbGV0IFVwcmV2ID0gVTE7CiAgICBmb3IgKGxldCBqID0gMjsgaiA8PSBpdGVyYXRpb25zOyBqKyspIHsKICAgICAgVXByZXYgPSBQUkYoVXByZXYpOwogICAgICBmb3IgKGxldCBrID0gMDsgayA8IGhMZW47IGsrKykgYmxvY2tCdWZba10gXj0gVXByZXZba107CiAgICB9CiAgICBjb25zdCBvZmZzZXQgPSAoaSAtIDEpICogaExlbjsKICAgIERLLnNldChibG9ja0J1Zi5zdWJhcnJheSgwLCBpID09PSBsID8gciA6IGhMZW4pLCBvZmZzZXQpOwogIH0KICAKICBibG9ja0J1Zi5maWxsKDApOwogIHJldHVybiBESzsKfQoKZXhwb3J0IGZ1bmN0aW9uIHBia2RmMlNoYTI1NkhleChvcHRzKSB7CiAgY29uc3Qgb3V0ID0gcGJrZGYyU2hhMjU2KG9wdHMpOwogIHJldHVybiBbLi4ub3V0XS5tYXAoKGIpID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpLmpvaW4oIiIpOwp9CgogIDwvc2NyaXB0PgoKICA8c2NyaXB0IHR5cGU9Im1vZHVsZS1zb3VyY2UiIGlkPSJ4MjU1MTktc2NyaXB0Ij4KICAgIApjb25zdCBQID0gKDFuIDw8IDI1NW4pIC0gMTluOyAKY29uc3QgQTI0ID0gMTIxNjY1bjsgCgpleHBvcnQgZnVuY3Rpb24gbGVCeXRlc1RvQmlnSW50KGxlKSB7CiAgbGV0IHggPSAwbjsKICBmb3IgKGxldCBpID0gbGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIHggPSAoeCA8PCA4bikgfCBCaWdJbnQobGVbaV0pOwogIH0KICByZXR1cm4geDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGJpZ0ludFRvTGVCeXRlcyh4LCBsZW4gPSAzMikgewogIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgbGV0IHYgPSB4OwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgIG91dFtpXSA9IE51bWJlcih2ICYgMHhmZm4pOwogICAgdiA+Pj0gOG47CiAgfQogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIGNsYW1wU2NhbGFyKGspIHsKICBjb25zdCBzID0gbmV3IFVpbnQ4QXJyYXkoayk7IAogIHNbMF0gJj0gMjQ4OwogIHNbMzFdICY9IDEyNzsKICBzWzMxXSB8PSA2NDsKICByZXR1cm4gczsKfQoKY29uc3QgbW9kID0gKGEpID0+IHsKICBhICU9IFA7CiAgcmV0dXJuIGEgPj0gMG4gPyBhIDogYSArIFA7Cn07Cgpjb25zdCBhZGQgPSAoYSwgYikgPT4gbW9kKGEgKyBiKTsKY29uc3Qgc3ViID0gKGEsIGIpID0+IG1vZChhIC0gYik7CmNvbnN0IG11bCA9IChhLCBiKSA9PiBtb2QoYSAqIGIpOwpjb25zdCBzcXIgPSAoYSkgPT4gbW9kKGEgKiBhKTsKCmZ1bmN0aW9uIHBvd01vZChiYXNlLCBleHApIHsKICBiYXNlID0gbW9kKGJhc2UpOwogIGxldCByZXN1bHQgPSAxbjsKICB3aGlsZSAoZXhwID4gMG4pIHsKICAgIGlmIChleHAgJiAxbikgcmVzdWx0ID0gbW9kKHJlc3VsdCAqIGJhc2UpOwogICAgYmFzZSA9IG1vZChiYXNlICogYmFzZSk7CiAgICBleHAgPj49IDFuOwogIH0KICByZXR1cm4gcmVzdWx0Owp9Cgpjb25zdCBpbnYgPSAoYSkgPT4gcG93TW9kKGEsIFAgLSAybik7CgpmdW5jdGlvbiBpc0FsbFplcm8zMih1OCkgewogIAogIGxldCBhY2MgPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDwgMzI7IGkrKykgYWNjIHw9IHU4W2ldOwogIHJldHVybiBhY2MgPT09IDA7Cn0KCmZ1bmN0aW9uIGNzd2FwKGNvbmQsIHgyLCB4MykgewogIGlmIChjb25kICE9PSAwbiAmJiBjb25kICE9PSAxbikKICAgIHRocm93IG5ldyBFcnJvcigiY3N3YXA6IGNvbmQgbXVzdCBiZSAwbiBvciAxbiIpOwogIGNvbnN0IG1hc2sgPSAtY29uZDsgCiAgY29uc3QgdHggPSAoeDIgXiB4MykgJiBtYXNrOwogIHJldHVybiBbeDIgXiB0eCwgeDMgXiB0eF07Cn0KCmZ1bmN0aW9uIG1vbnRnb21lcnlMYWRkZXIoc2NhbGFyQnl0ZXMsIHVCeXRlcykgewogIGNvbnN0IGsgPSBsZUJ5dGVzVG9CaWdJbnQoY2xhbXBTY2FsYXIoc2NhbGFyQnl0ZXMpKTsKICAKICBjb25zdCB1TEUgPSBuZXcgVWludDhBcnJheSh1Qnl0ZXMpOwogIHVMRVszMV0gJj0gMHg3ZjsKICBjb25zdCB4MSA9IG1vZChsZUJ5dGVzVG9CaWdJbnQodUxFKSk7CgogIGxldCB4MiA9IDFuLAogICAgejIgPSAwbjsKICBsZXQgeDMgPSB4MSwKICAgIHozID0gMW47CiAgbGV0IHN3YXAgPSAwbjsKCiAgZm9yIChsZXQgdCA9IDI1NDsgdCA+PSAwOyB0LS0pIHsKICAgIGNvbnN0IGt0ID0gKGsgPj4gQmlnSW50KHQpKSAmIDFuOwogICAgc3dhcCBePSBrdDsKICAgIFt4MiwgeDNdID0gY3N3YXAoc3dhcCwgeDIsIHgzKTsKICAgIFt6MiwgejNdID0gY3N3YXAoc3dhcCwgejIsIHozKTsKICAgIHN3YXAgPSBrdDsKCiAgICBjb25zdCBBID0gYWRkKHgyLCB6Mik7CiAgICBjb25zdCBBQSA9IHNxcihBKTsKICAgIGNvbnN0IEIgPSBzdWIoeDIsIHoyKTsKICAgIGNvbnN0IEJCID0gc3FyKEIpOwogICAgY29uc3QgRSA9IHN1YihBQSwgQkIpOwogICAgY29uc3QgQyA9IGFkZCh4MywgejMpOwogICAgY29uc3QgRCA9IHN1Yih4MywgejMpOwogICAgY29uc3QgREEgPSBtdWwoRCwgQSk7CiAgICBjb25zdCBDQiA9IG11bChDLCBCKTsKICAgIGNvbnN0IHgzbiA9IHNxcihhZGQoREEsIENCKSk7CiAgICBjb25zdCB6M24gPSBtdWwoeDEsIHNxcihzdWIoREEsIENCKSkpOwogICAgY29uc3QgeDJuID0gbXVsKEFBLCBCQik7CiAgICBjb25zdCB6Mm4gPSBtdWwoRSwgYWRkKEFBLCBtdWwoQTI0LCBFKSkpOwoKICAgIHgzID0geDNuOwogICAgejMgPSB6M247CiAgICB4MiA9IHgybjsKICAgIHoyID0gejJuOwogIH0KCiAgW3gyLCB4M10gPSBjc3dhcChzd2FwLCB4MiwgeDMpOwogIFt6MiwgejNdID0gY3N3YXAoc3dhcCwgejIsIHozKTsKCiAgY29uc3QgcmVzID0gbXVsKHgyLCBpbnYoejIpKTsKICByZXR1cm4gYmlnSW50VG9MZUJ5dGVzKHJlcywgMzIpOwp9Cgpjb25zdCBhc3NlcnRVODMyID0gKGFyciwgbmFtZSkgPT4gewogIGlmICghKGFyciBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHx8IGFyci5sZW5ndGggIT09IDMyKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bmFtZX0gbXVzdCBiZSBVaW50OEFycmF5KDMyKWApOwogIH0KfTsKCmV4cG9ydCBmdW5jdGlvbiB4MjU1MTkoc2NhbGFyLCB1KSB7CiAgYXNzZXJ0VTgzMihzY2FsYXIsICJzY2FsYXIiKTsKICBhc3NlcnRVODMyKHUsICJ1Iik7CiAgcmV0dXJuIG1vbnRnb21lcnlMYWRkZXIoc2NhbGFyLCB1KTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHNoYXJlZEtleShzZWNyZXRLZXksIHB1YmxpY0tleSkgewogIGNvbnN0IHNzID0geDI1NTE5KHNlY3JldEtleSwgcHVibGljS2V5KTsKICBpZiAoaXNBbGxaZXJvMzIoc3MpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBvcGVyYXRpb24gZmFpbGVkIGZvciBhbiBvcGVyYXRpb24tc3BlY2lmaWMgcmVhc29uIik7CiAgfQogIHJldHVybiBzczsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlS2V5UGFpcigpIHsKICBjb25zdCBzZWNyZXRLZXkgPSBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KDMyKSk7CiAgY29uc3QgY2xhbXBlZCA9IGNsYW1wU2NhbGFyKHNlY3JldEtleSk7CiAgY29uc3QgYmFzZVBvaW50ID0gbmV3IFVpbnQ4QXJyYXkoMzIpOwogIGJhc2VQb2ludFswXSA9IDk7IAogIGNvbnN0IHB1YmxpY0tleSA9IHgyNTUxOShjbGFtcGVkLCBiYXNlUG9pbnQpOwogIHJldHVybiB7IHB1YmxpY0tleSwgc2VjcmV0S2V5OiBjbGFtcGVkIH07Cn0KCiAgPC9zY3JpcHQ+CgogIDxzY3JpcHQgdHlwZT0ibW9kdWxlIj4KICAgIGNvbnN0ICQgPSAocykgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzKTsKCiAgICBhc3luYyBmdW5jdGlvbiBsb2FkSW5saW5lTW9kdWxlKGlkKSB7CiAgICAgIGNvbnN0IGNvZGUgPSAkKCcjJyArIGlkKS50ZXh0Q29udGVudDsKICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbY29kZV0sIHsgdHlwZTogJ3RleHQvamF2YXNjcmlwdCcgfSkpOwogICAgICByZXR1cm4geyBtb2R1bGU6IGF3YWl0IGltcG9ydCh1cmwpLCBjb2RlIH07CiAgICB9CgogICAgY29uc3QgYWVzMjU2Z2NtID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgnYWVzMjU2Z2NtLXNjcmlwdCcpOwogICAgY29uc3QgcGJoa2RmID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgncGJrZGYyLXNjcmlwdCcpOwogICAgY29uc3QgeDI1NTE5ID0gYXdhaXQgbG9hZElubGluZU1vZHVsZSgneDI1NTE5LXNjcmlwdCcpOwoKICAgIGNvbnN0IERFQ09ERV9URU1QTEFURSA9ICQoIiNkZWNvZGUtdGVtcGxhdGUiKS5pbm5lckhUTUw7CgogICAgLy8gR2xvYmFsIHN0YXRlCiAgICBsZXQgZW5jcnlwdGlvbktleSA9IG51bGw7CiAgICBsZXQgbXlQcml2YXRlS2V5ID0gbnVsbDsKICAgIGxldCBteVB1YmxpY0tleSA9IG51bGw7CgogICAgLy8gLS0tIGhlbHBlcnMgLS0tCiAgICBjb25zdCBlbmMgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgIGNvbnN0IGI2NCA9IChidWYpID0+IGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZSguLi5uZXcgVWludDhBcnJheShidWYpKSk7CiAgICBjb25zdCB1bmI2NCA9IChzdHIpID0+IG5ldyBVaW50OEFycmF5KFsuLi5hdG9iKHN0cildLm1hcChjID0+IGMuY2hhckNvZGVBdCgwKSkpOwogICAgY29uc3QgcmFuZCA9IChuKSA9PiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50OEFycmF5KG4pKTsKCiAgICBhc3luYyBmdW5jdGlvbiBlbmNyeXB0TWVzc2FnZShtZXNzYWdlKSB7CiAgICAgIGVuY3J5cHRpb25LZXkgPSByYW5kKDMyKTsgLy8gR2VuZXJhdGUgcmFuZG9tIGtleQogICAgICBjb25zdCBpdiA9IHJhbmQoMTIpOwoKICAgICAgY29uc3QgeyBjaXBoZXJ0ZXh0LCB0YWcgfSA9IGFlczI1NmdjbS5tb2R1bGUuYWVzMjU2R2NtRW5jcnlwdCh7CiAgICAgICAga2V5OiBlbmNyeXB0aW9uS2V5LAogICAgICAgIGl2OiBpdiwKICAgICAgICBwbGFpbnRleHQ6IGVuYy5lbmNvZGUobWVzc2FnZSkKICAgICAgfSk7CgogICAgICByZXR1cm4geyBjdEI2NDogYjY0KGNpcGhlcnRleHQpLCBpdkI2NDogYjY0KGl2KSwgdGFnQjY0OiBiNjQodGFnKSB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1aWxkRGVjb2RlSFRNTCh0ZW1wbGF0ZSwgeyBjdEI2NCwgaXZCNjQsIHRhZ0I2NCwgcHViQUI2NCB9KSB7CiAgICAgIHJldHVybiB0ZW1wbGF0ZQogICAgICAgIC5yZXBsYWNlQWxsKCJfX0NJUEhFUlRFWFRfQjY0X18iLCBjdEI2NCkKICAgICAgICAucmVwbGFjZUFsbCgiX19JVl9CNjRfXyIsIGl2QjY0KQogICAgICAgIC5yZXBsYWNlQWxsKCJfX1RBR19CNjRfXyIsIHRhZ0I2NCkKICAgICAgICAucmVwbGFjZUFsbCgiX19QVUJBX0I2NF9fIiwgcHViQUI2NCkKICAgICAgICAucmVwbGFjZUFsbCgiX19JTkNMVURFX0FFUzI1NkdDTV9KU18yX18iLCBhZXMyNTZnY20uY29kZSkKICAgICAgICAucmVwbGFjZUFsbCgiX19JTkNMVURFX1gyNTUxOV9KU18yX18iLCB4MjU1MTkuY29kZSkKICAgICAgICAucmVwbGFjZUFsbCgiX19JTkNMVURFX0hNQUNfSlNfMl9fIiwgcGJoa2RmLmNvZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvRGF0YVVSTChodG1sKSB7CiAgICAgIGNvbnN0IHV0ZjggPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoaHRtbCk7CiAgICAgIGxldCBzID0gIiI7CiAgICAgIGZvciAoY29uc3QgYyBvZiB1dGY4KSBzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7CiAgICAgIGNvbnN0IGI2NHVybCA9IGJ0b2Eocyk7CiAgICAgIHJldHVybiBgZGF0YTp0ZXh0L2h0bWw7YmFzZTY0LCR7YjY0dXJsfWA7CiAgICB9CgogICAgYXN5bmMgZnVuY3Rpb24gY29weVRvQ2xpcGJvYXJkKHRleHQsIGJ1dHRvbikgewogICAgICBjb25zdCBvcmlnaW5hbFRleHQgPSBidXR0b24udGV4dENvbnRlbnQ7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodGV4dCk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTsKICAgICAgICB0ZXh0YXJlYS52YWx1ZSA9IHRleHQ7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7CiAgICAgICAgdGV4dGFyZWEuc2VsZWN0KCk7CiAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRhcmVhKTsKICAgICAgfQogICAgICBidXR0b24udGV4dENvbnRlbnQgPSAiQ29waWVkISI7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDsKICAgICAgfSwgMjAwMCk7CiAgICB9CgogICAgLy8gRXZlbnQgbGlzdGVuZXJzCiAgICAkKCIjZW5jcnlwdC1idG4iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFzeW5jICgpID0+IHsKICAgICAgY29uc3Qgc2VjcmV0ID0gJCgiI3NlY3JldCIpLnZhbHVlLnRyaW0oKTsKICAgICAgaWYgKCFzZWNyZXQpIHsKICAgICAgICBhbGVydCgiUGxlYXNlIGVudGVyIGEgc2VjcmV0IG1lc3NhZ2UuIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIC8vIEVuY3J5cHQgdGhlIG1lc3NhZ2UKICAgICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgZW5jcnlwdE1lc3NhZ2Uoc2VjcmV0KTsKCiAgICAgICAgLy8gR2VuZXJhdGUgWDI1NTE5IGtleXBhaXIKICAgICAgICBjb25zdCBrZXlwYWlyID0geDI1NTE5Lm1vZHVsZS5nZW5lcmF0ZUtleVBhaXIoKTsKICAgICAgICBteVByaXZhdGVLZXkgPSBrZXlwYWlyLnNlY3JldEtleTsKICAgICAgICBteVB1YmxpY0tleSA9IGtleXBhaXIucHVibGljS2V5OwoKICAgICAgICAvLyBCdWlsZCBkZWNvZGUgdGVtcGxhdGUgd2l0aCBjaXBoZXJ0ZXh0IGFuZCBvdXIgcHVibGljIGtleQogICAgICAgIGNvbnN0IGRlY29kZUhUTUwgPSBidWlsZERlY29kZUhUTUwoREVDT0RFX1RFTVBMQVRFLCB7CiAgICAgICAgICAuLi5wYXlsb2FkLAogICAgICAgICAgcHViQUI2NDogYjY0KG15UHVibGljS2V5KQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCB1cmwgPSB0b0RhdGFVUkwoZGVjb2RlSFRNTCk7CiAgICAgICAgJCgiI3VybCIpLnRleHRDb250ZW50ID0gdXJsOwoKICAgICAgICAvLyBVcGRhdGUgVUkKICAgICAgICAkKCIjc2VjcmV0IikuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICQoIiNlbmNyeXB0LWJ0biIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgJCgiI3Nob3ctc2VjcmV0LWJ0biIpLmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgICQoIiN1cmwtb3V0cHV0IikuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgJCgiI3N0ZXAyIikuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBhbGVydChgRXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7CiAgICAgIH0KICAgIH0pOwoKICAgICQoIiNzaG93LXNlY3JldC1idG4iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgJCgiI3NlY3JldCIpLmRpc2FibGVkID0gISQoIiNzZWNyZXQiKS5kaXNhYmxlZDsKICAgICAgJCgiI3Nob3ctc2VjcmV0LWJ0biIpLnRleHRDb250ZW50ID0gJCgiI3NlY3JldCIpLmRpc2FibGVkID8gIlNob3cgU2VjcmV0IiA6ICJIaWRlIFNlY3JldCI7CiAgICB9KTsKCiAgICAkKCIjY29weS11cmwiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgY29uc3QgdXJsID0gJCgiI3VybCIpLnRleHRDb250ZW50OwogICAgICBpZiAodXJsKSBjb3B5VG9DbGlwYm9hcmQodXJsLCAkKCIjY29weS11cmwiKSk7CiAgICB9KTsKCiAgICAkKCIjZ2VuZXJhdGUtZW5jcnlwdGVkLWtleSIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgYXN5bmMgKCkgPT4gewogICAgICBjb25zdCByZWNpcGllbnRQdWJLZXlCNjQgPSAkKCIjcmVjaXBpZW50LXB1YmtleSIpLnZhbHVlLnRyaW0oKTsKICAgICAgaWYgKCFyZWNpcGllbnRQdWJLZXlCNjQpIHsKICAgICAgICBhbGVydCgiUGxlYXNlIGVudGVyIHRoZSByZWNpcGllbnQncyBwdWJsaWMga2V5LiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZWNpcGllbnRQdWJLZXkgPSB1bmI2NChyZWNpcGllbnRQdWJLZXlCNjQpOwoKICAgICAgICAvLyBHZW5lcmF0ZSBzaGFyZWQgc2VjcmV0CiAgICAgICAgY29uc3Qgc2hhcmVkU2VjcmV0ID0geDI1NTE5Lm1vZHVsZS5zaGFyZWRLZXkobXlQcml2YXRlS2V5LCByZWNpcGllbnRQdWJLZXkpOwoKICAgICAgICAvLyBEZXJpdmUgc2hhcmVkIGtleSB1c2luZyBITUFDCiAgICAgICAgY29uc3Qgc2hhcmVkS2V5ID0gcGJoa2RmLm1vZHVsZS5obWFjU2hhMjU2KHNoYXJlZFNlY3JldCwgZW5jLmVuY29kZSgiQ2lwaGVyTGluay1LZXlEZXJpdmF0aW9uIikpLnNsaWNlKDAsIDMyKTsKCiAgICAgICAgLy8gRW5jcnlwdCB0aGUgb3JpZ2luYWwgbWVzc2FnZSBrZXkKICAgICAgICBjb25zdCBpdiA9IHJhbmQoMTIpOwogICAgICAgIGNvbnN0IHsgY2lwaGVydGV4dCwgdGFnIH0gPSBhZXMyNTZnY20ubW9kdWxlLmFlczI1NkdjbUVuY3J5cHQoewogICAgICAgICAga2V5OiBzaGFyZWRLZXksCiAgICAgICAgICBpdjogaXYsCiAgICAgICAgICBwbGFpbnRleHQ6IGVuY3J5cHRpb25LZXkKICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgZW5jcnlwdGVkS2V5RGF0YSA9IHsKICAgICAgICAgIGN0OiBiNjQoY2lwaGVydGV4dCksCiAgICAgICAgICBpdjogYjY0KGl2KSwKICAgICAgICAgIHRhZzogYjY0KHRhZykKICAgICAgICB9OwoKICAgICAgICAkKCIjZW5jcnlwdGVkLWtleSIpLnRleHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoZW5jcnlwdGVkS2V5RGF0YSk7CiAgICAgICAgJCgiI2VuY3J5cHRlZC1rZXktb3V0cHV0IikuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CgogICAgICAgIC8vIENsZWFuIHVwIHNlbnNpdGl2ZSBkYXRhCiAgICAgICAgbXlQcml2YXRlS2V5LmZpbGwoMCk7CiAgICAgICAgc2hhcmVkU2VjcmV0LmZpbGwoMCk7CiAgICAgICAgc2hhcmVkS2V5LmZpbGwoMCk7CgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBhbGVydChgRXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7CiAgICAgIH0KICAgIH0pOwoKICAgICQoIiNjb3B5LWVuY3J5cHRlZC1rZXkiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgY29uc3Qga2V5ID0gJCgiI2VuY3J5cHRlZC1rZXkiKS50ZXh0Q29udGVudDsKICAgICAgaWYgKGtleSkgY29weVRvQ2xpcGJvYXJkKGtleSwgJCgiI2NvcHktZW5jcnlwdGVkLWtleSIpKTsKICAgIH0pOwoKICA8L3NjcmlwdD4KPC9ib2R5PgoKPC9odG1sPg==
```